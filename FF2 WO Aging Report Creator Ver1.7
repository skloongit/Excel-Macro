Dim mySuccess  As String
Dim myAttachement() As String
Sub FileSelect()
    myRow = ActiveSheet.Shapes(Application.Caller).BottomRightCell.Row
    myGetFile = Application.GetOpenFilename(, , "Please select " & Range("A" & myRow).Value & " file:")
        If myGetFile = False Then
            End
        Else
            mySelect = myGetFile
            Range("B" & myRow).Value = mySelect
        End If
End Sub
Sub FileSelect1()
    myMacroFile = ActiveWorkbook.Name
    myRow = ActiveSheet.Shapes(Application.Caller).BottomRightCell.Row
    myGetFile = Application.GetOpenFilename(, , "Please select " & Range("A" & myRow).Value & " file:")
        If myGetFile = False Then
            End
        Else
            mySelect = myGetFile
            Range("B" & myRow).Value = mySelect
        End If
    Workbooks.Open Range("B15").Value, , True
    myBomFile = ActiveWorkbook.Name
    myBomSheet = ActiveSheet.Name
    If ActiveSheet.AutoFilterMode = True Then
       Rows("2:2").AutoFilter
    End If
    myTempLast = Range("E" & Rows.Count).End(xlUp).Row
    Range("E2:E" & myTempLast).RemoveDuplicates Columns:=1, Header:=xlNo
    myTempLast = Range("E" & Rows.Count).End(xlUp).Row
    Workbooks(myMacroFile).Activate
    Sheets("AssyPartList").Columns("A:A").ClearContents
    Range("B22:B" & Rows.Count).ClearContents
    Range("B22:B" & Rows.Count).Validation.Delete
    If Workbooks(myBomFile).Sheets(myBomSheet).Range("E3").Value <> "" Then
        Sheets("AssyPartList").Range("A1:A" & myTempLast - 2).Value = Workbooks(myBomFile).Sheets(myBomSheet).Range("E3:E" & myTempLast).Value
        
        'Range("B22:B" & myTempLast + 19).Select
        With Range("B22:B" & myTempLast + 19).Validation
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=AssyPartList!$A$1:$A$" & myTempLast - 2
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = ""
            .InputMessage = ""
            .ErrorMessage = ""
            .ShowInput = True
            .ShowError = True
        End With
    End If
    'Range("B22:B" & myTempLast + 19).Value = Sheets("AssyPartList").Range("A1:A" & myTempLast - 2).Value
    Workbooks(myBomFile).Close False
End Sub
Sub Ff2Aging()
    ReDim myAttachement(0)
    'myStrTime = Time
    myMacroFile = ActiveWorkbook.Name
    myMacroPath = ActiveWorkbook.Path
    
    myLastWw = Range("C6").Value
    myLastMth = Range("E6").Value
    myLastQtr = Range("D6").Value
    myLastDate = Range("B6").Value
    
    myCurWw = Range("C7").Value
    myCurMth = Range("E7").Value
    myCurQtr = Range("D7").Value
    
'    myLastQtrAgingFile = myLastQtr & " Aging.xlsx"
'    myCurQtrAgingFile = myCurQtr & " Aging.xlsx"
'
'    myQtrFolderCheck = Dir("\\pena-dsk-601\ISL_General\01.Magnum\MCC\Quater Report\" & myCurQtr & "\", vbDirectory)
'    If myQtrFolderCheck = "" Then
'        MkDir "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Quater Report\" & myCurQtr & "\"
'        Call FileCopy("\\pena-dsk-601\ISL_General\01.Magnum\MCC\Quater Report\" & myLastQtr & "\" & myLastQtrAgingFile, "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Quater Report\" & myCurQtr & "\" & myCurQtrAgingFile)
'        myNewQtr = "Yes"
'    End If
    
    'Aging File Check
    myAgingCheck = Dir(myMacroPath & "\Aging File\" & Year(myLastDate) & "\FF2 Aging - " & Format(myLastDate, "YYYYMMDD") & ".xlsx", vbNormal)
    If myAgingCheck = "" Then
        'SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "FF2 Aging - " & Format(myLastDate, "YYYYMMDD") & ".xlsx file not found!"
        Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>FF2 Aging - " & Format(myLastDate, "YYYYMMDD") & ".xlsx file not found!</html>", _
                        myAttachement(), _
                        0, 0)
        
        GoTo myEnd
    End If
    
    'Configuration File Check
    myConfigCheck = Dir(myMacroPath & "\FF2 WO Aging Report Configuration.xlsx")
    If myConfigCheck = "" Then
        'SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "FF2 WO Aging Report Configuration.xlsx file not found!"
        Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>FF2 WO Aging Report Configuration.xlsx file not found!</html>", _
                        myAttachement(), _
                        0, 0)
        
        GoTo myEnd
    End If
    
    'Ver1.5:
    '\\pena-dsk-601\ISL_General\01.Magnum\MCC
    '\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC
    
    'Aging Raw File Check
    'myAgingRawCheck = Dir("\\pena-dsk-601\ISL_General\01.Magnum\MCC\MACRO WIP\" & Format(myLastDate + 14, "Yyyy") & "\" & Format(myLastDate + 14, "Mmm") & "\Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx")
    myAgingRawCheck = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\MACRO WIP\" & Format(myLastDate + 14, "Yyyy") & "\" & Format(myLastDate + 14, "Mmm") & "\Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx")
    If myAgingRawCheck = "" Then
        'SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx file not found!"
        Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx file not found!</html>", _
                        myAttachement(), _
                        0, 0)
        
        GoTo myEnd
    End If
    
    'Workbooks.Open "\\pena-dsk-601\ISL_General\01.Magnum\MCC\MACRO WIP\" & Format(myLastDate + 14, "Yyyy") & "\" & Format(myLastDate + 14, "Mmm") & "\Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx", False, True
    Workbooks.Open "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\MACRO WIP\" & Format(myLastDate + 14, "Yyyy") & "\" & Format(myLastDate + 14, "Mmm") & "\Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx", False, True
    
    myRawAging = ActiveWorkbook.Name
    ActiveSheet.Name = "Temp"
    myCheckHeader = Application.WorksheetFunction.CountIf(Columns("A:A"), "All Open Work Orders in Descending Order")
    If myCheckHeader = 0 Then
        'SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "Cannot find All Open Work Orders in Descending Order wording..."
        Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>All Open Work Orders in Descending Order</html>", _
                        myAttachement(), _
                        0, 0)
        
        ActiveWorkbook.Close False
        GoTo myEnd
    End If
    myCheckHeader = Application.WorksheetFunction.Match("All Open Work Orders in Descending Order", Columns("A:A"), 0)
    Rows("1:" & myCheckHeader).ClearContents
    Sheets.Add
    ActiveSheet.Name = "MPF"
    Sheets("Temp").Columns("F:F").Copy
    Range("A1").PasteSpecial xlPasteAll
    myPivotTotal = Range("A" & Rows.Count).End(xlUp).Row
    Range("B1:B" & myPivotTotal).Value = "=IF(OR(A1="""",A1=""16X"",A1=318,A1=198,A1=260,A1=6,A1=875),""Plan Fmly"",Text(A1,""000""))"
    Range("B1:B" & myPivotTotal).Copy
    Range("B1").PasteSpecial xlPasteValues
    Range("A1:B" & myPivotTotal).RemoveDuplicates Columns:=2, Header:=xlNo
    myPivotTotal = Range("A" & Rows.Count).End(xlUp).Row
    ActiveWorkbook.Worksheets("MPF").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("MPF").Sort.SortFields.Add Key:=Range("B2:B" & myPivotTotal), SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    ActiveWorkbook.Worksheets("MPF").Sort.SetRange Range("B1:B" & myPivotTotal)
    ActiveWorkbook.Worksheets("MPF").Sort.Header = xlYes
    ActiveWorkbook.Worksheets("MPF").Sort.MatchCase = False
    ActiveWorkbook.Worksheets("MPF").Sort.Orientation = xlTopToBottom
    ActiveWorkbook.Worksheets("MPF").Sort.SortMethod = xlPinYin
    ActiveWorkbook.Worksheets("MPF").Sort.Apply
    
    
    'Workbooks.Open "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Quater Report\" & myCurQtr & "\" & myCurQtrAgingFile, False
    Workbooks.Open myMacroPath & "\Aging File\" & Year(myLastDate) & "\FF2 Aging - " & Format(myLastDate, "YYYYMMDD") & ".xlsx", False
    MasterFileSelect
    If ActiveSheet.Name <> "FF2 WO+WR Aging " Then
        'SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "Cannot find FF2 WO+WR Aging sheet..."
        Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Cannot find FF2 WO+WR Aging sheet...</html>", _
                        myAttachement(), _
                        0, 0)
        
        ActiveWorkbook.Close False
        Workbooks(myRawAging).Close False
        GoTo myEnd
    End If
    
    'Check all MPF Available or not?
    For myA = 2 To myPivotTotal
        Sheets("FF2 WO+WR Aging ").Select
        myMpf = Workbooks(myRawAging).Sheets("MPF").Range("B" & myA).Value
        myMpfCheck = Application.WorksheetFunction.CountIf(Columns("A:A"), myMpf)
        If myMpfCheck = 0 Then
            For myB = 1 To 2
                If myB = 1 Then
                    mySheet = "FF2 WO+WR Aging "
                    myWork = "WOWR"
                Else
                    mySheet = "FF2 WS Aging"
                    myWork = "WS"
                End If
                Sheets(mySheet).Select
                    'Ver1.3:
                    'Rows("31:60").Copy
                    Rows("61:90").Copy
                    'myRowInsert = Range("A" & Rows.Count).End(xlUp).Row + 30
                    myRowInsert = Range("A" & Rows.Count).End(xlUp).Row + 23
                Rows(myRowInsert).Insert
                    'Ver1.3:
                    'Rows(myRowInsert + 1 & ":" & myRowInsert + 4).ClearContents
                    Rows(myRowInsert + 1 & ":" & myRowInsert + 6).ClearContents
                    'Range("B32:B35").Copy Range("B" & myRowInsert + 1)
                    Range("B62:B67").Copy Range("B" & myRowInsert + 1)
                Range("A" & myRowInsert).Value = "'" & myMpf
                    For Each Item In ActiveSheet.ChartObjects
                        'Ver1.3:
                        'If Item.Name = "Chart148" & myWork And Item.BottomRightCell.Row > 60 The
                        If Item.Name = "Chart148" & myWork And Item.BottomRightCell.Row > 90 Then
                            Item.Activate
                            Item.Name = "Chart" & myMpf & myWork
                            'Ver1.3:
                            'ActiveChart.FullSeriesCollection(1).Name = "='" & mySheet & "'!$B$" & myRowInsert + 5
                            'ActiveChart.FullSeriesCollection(1).Values = "='" & mySheet & "'!$C$" & myRowInsert + 5 & ":$F$" & myRowInsert + 5
                            'ActiveChart.FullSeriesCollection(2).Name = "='" & mySheet & "'!$B$" & myRowInsert + 4
                            'ActiveChart.FullSeriesCollection(2).Values = "='" & mySheet & "'!$C$" & myRowInsert + 4 & ":$F$" & myRowInsert + 4
                            'ActiveChart.FullSeriesCollection(3).Name = "='" & mySheet & "'!$B$" & myRowInsert + 3
                            'ActiveChart.FullSeriesCollection(3).Values = "='" & mySheet & "'!$C$" & myRowInsert + 3 & ":$F$" & myRowInsert + 3
                            'ActiveChart.FullSeriesCollection(4).Name = "='" & mySheet & "'!$B$" & myRowInsert + 2
                            'ActiveChart.FullSeriesCollection(4).Values = "='" & mySheet & "'!$C$" & myRowInsert + 2 & ":$F$" & myRowInsert + 2
                            'ActiveChart.FullSeriesCollection(5).Name = "='" & mySheet & "'!$B$" & myRowInsert + 1
                            'ActiveChart.FullSeriesCollection(5).Values = "='" & mySheet & "'!$C$" & myRowInsert + 1 & ":$F$" & myRowInsert + 1
                            'ActiveChart.FullSeriesCollection(5).XValues = "='" & mySheet & "'!$C$" & myRowInsert & ":$F$" & myRowInsert
                            
                            ActiveChart.FullSeriesCollection(1).Name = "='" & mySheet & "'!$B$" & myRowInsert + 7
                            ActiveChart.FullSeriesCollection(1).Values = "='" & mySheet & "'!$C$" & myRowInsert + 7 & ":$F$" & myRowInsert + 7
                            ActiveChart.FullSeriesCollection(2).Name = "='" & mySheet & "'!$B$" & myRowInsert + 6
                            ActiveChart.FullSeriesCollection(2).Values = "='" & mySheet & "'!$C$" & myRowInsert + 6 & ":$F$" & myRowInsert + 6
                            ActiveChart.FullSeriesCollection(3).Name = "='" & mySheet & "'!$B$" & myRowInsert + 5
                            ActiveChart.FullSeriesCollection(3).Values = "='" & mySheet & "'!$C$" & myRowInsert + 5 & ":$F$" & myRowInsert + 5
                            ActiveChart.FullSeriesCollection(4).Name = "='" & mySheet & "'!$B$" & myRowInsert + 4
                            ActiveChart.FullSeriesCollection(4).Values = "='" & mySheet & "'!$C$" & myRowInsert + 4 & ":$F$" & myRowInsert + 4
                            ActiveChart.FullSeriesCollection(5).Name = "='" & mySheet & "'!$B$" & myRowInsert + 3
                            ActiveChart.FullSeriesCollection(5).Values = "='" & mySheet & "'!$C$" & myRowInsert + 3 & ":$F$" & myRowInsert + 3
                            ActiveChart.FullSeriesCollection(6).Name = "='" & mySheet & "'!$B$" & myRowInsert + 2
                            ActiveChart.FullSeriesCollection(6).Values = "='" & mySheet & "'!$C$" & myRowInsert + 2 & ":$F$" & myRowInsert + 2
                            ActiveChart.FullSeriesCollection(7).Name = "='" & mySheet & "'!$B$" & myRowInsert + 1
                            ActiveChart.FullSeriesCollection(7).Values = "='" & mySheet & "'!$C$" & myRowInsert + 1 & ":$F$" & myRowInsert + 1
                            ActiveChart.FullSeriesCollection(7).XValues = "='" & mySheet & "'!$C$" & myRowInsert & ":$F$" & myRowInsert
                            
                            Exit For
                        End If
                        
                    Next Item

            Next myB
        End If
    Next myA
    
    Sheets("FF2 WO+WR Aging ").Select
    myFirstLastCol = Range("B1").End(xlToRight).Column
    Columns(myFirstLastCol).Copy
    Columns(myFirstLastCol).Insert
            'Ver1.3:
            Cells(31, myFirstLastCol + 1).Value = "ww" & myCurWw
            'Cells(31, myFirstLastCol + 1).Select
            Cells(61, myFirstLastCol + 1).Select
            
        myRow = ActiveCell.Row
        Cells(1, myFirstLastCol + 1).Value = "ww" & myCurWw
        Selection.Value = "ww" & myCurWw
        'Ver1.3
        'Selection.Offset(1, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">90"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
        'Selection.Offset(2, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
        'Selection.Offset(3, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
        'Selection.Offset(4, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">14"",'[" & myRawAging & "]Temp'!$A:$A,""<31"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">14"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
        'Selection.Offset(5, 0).Value = "=SUM(R[-4]C:R[-1]C)"
        
        Selection.Offset(1, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">365"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">365"")"
        Selection.Offset(2, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">180"",'[" & myRawAging & "]Temp'!$A:$A,""<366"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">180"",'[" & myRawAging & "]Temp'!$A:$A,""<366"")"
        Selection.Offset(3, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">120"",'[" & myRawAging & "]Temp'!$A:$A,""<181"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">120"",'[" & myRawAging & "]Temp'!$A:$A,""<181"")"
        Selection.Offset(4, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">90"",'[" & myRawAging & "]Temp'!$A:$A,""<121"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">90"",'[" & myRawAging & "]Temp'!$A:$A,""<121"")"
        Selection.Offset(5, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
        Selection.Offset(6, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">29"",'[" & myRawAging & "]Temp'!$A:$A,""<61"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">29"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
        Selection.Offset(7, 0).Value = "=SUM(R[-6]C:R[-1]C)"
        
        Selection.End(xlDown).Select
        Selection.End(xlDown).Select
        Do Until ActiveCell.Row = Rows.Count
                'Ver1.3
                'Range(Cells(31, myFirstLastCol + 1), Cells(36, myFirstLastCol + 1)).Copy
                Range(Cells(61, myFirstLastCol + 1), Cells(68, myFirstLastCol + 1)).Copy
            Selection.PasteSpecial xlAll
            Selection.End(xlDown).Select
            Selection.End(xlDown).Select
        Loop
    Cells(31, myFirstLastCol + 1).Select
    myTempLastCell = Cells(Rows.Count, myFirstLastCol + 1).End(xlUp).Row
    'Ver1.3
    'Range(Cells(31, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value = Range(Cells(31, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value
    Range(Cells(61, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value = Range(Cells(61, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value
    
    Sheets("FF2 WS Aging").Select
    myFirstLastCol = Range("B1").End(xlToRight).Column
    Columns(myFirstLastCol).Copy
    Columns(myFirstLastCol).Insert
            'Ver1.3:
            Cells(31, myFirstLastCol + 1).Value = "ww" & myCurWw
            'Cells(31, myFirstLastCol + 1).Select
            Cells(61, myFirstLastCol + 1).Select
        myRow = ActiveCell.Row
        Cells(1, myFirstLastCol + 1).Value = "ww" & myCurWw
        Selection.Value = "ww" & myCurWw
        'Selection.Offset(1, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
        'Selection.Offset(2, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
        'Selection.Offset(3, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
        'Selection.Offset(4, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">14"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
        'Selection.Offset(5, 0).Value = "=SUM(R[-4]C:R[-1]C)"
        Selection.Offset(1, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">365"")"
        Selection.Offset(2, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">180"",'[" & myRawAging & "]Temp'!$A:$A,""<366"")"
        Selection.Offset(3, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">120"",'[" & myRawAging & "]Temp'!$A:$A,""<181"")"
        Selection.Offset(4, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">90"",'[" & myRawAging & "]Temp'!$A:$A,""<121"")"
        Selection.Offset(5, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
        Selection.Offset(6, 0).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,$A" & myRow & ",'[" & myRawAging & "]Temp'!$A:$A,"">29"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
        Selection.Offset(7, 0).Value = "=SUM(R[-6]C:R[-1]C)"
        Selection.End(xlDown).Select
        Selection.End(xlDown).Select
        Do Until ActiveCell.Row = Rows.Count
                'Ver1.3:
                'Range(Cells(31, myFirstLastCol + 1), Cells(36, myFirstLastCol + 1)).Copy
                Range(Cells(61, myFirstLastCol + 1), Cells(68, myFirstLastCol + 1)).Copy
            Selection.PasteSpecial xlAll
            Selection.End(xlDown).Select
            Selection.End(xlDown).Select
        Loop
    Cells(31, myFirstLastCol + 1).Select
    myTempLastCell = Cells(Rows.Count, myFirstLastCol + 1).End(xlUp).Row
    'Ver1.3
    'Range(Cells(31, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value = Range(Cells(31, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value
    Range(Cells(61, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value = Range(Cells(61, myFirstLastCol + 1), Cells(myTempLastCell, myFirstLastCol + 1)).Value
    
'    'First Table
'        'Ver1.1: Add in >15 to 30 Days
'        'Range(Cells(4, myFirstLastCol + 1), Cells(8, myFirstLastCol + 1)).Copy
'        Range(Cells(4, myFirstLastCol + 1), Cells(9, myFirstLastCol + 1)).Copy
'    Cells(4, myFirstLastCol).PasteSpecial xlAll
'    Cells(4, myFirstLastCol + 1).Value = "ww" & myCurWw
'    Cells(5, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">90"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
'    Cells(5, myFirstLastCol + 1).Value = Cells(5, myFirstLastCol + 1).Value
'    Cells(6, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
'    Cells(6, myFirstLastCol + 1).Value = Cells(6, myFirstLastCol + 1).Value
'    Cells(7, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
'    Cells(7, myFirstLastCol + 1).Value = Cells(7, myFirstLastCol + 1).Value
'        'Ver1.1: Add in >15 to 30 Days
'        Cells(8, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
'        Cells(8, myFirstLastCol + 1).Value = Cells(8, myFirstLastCol + 1).Value
'
'    'Second Table
'    mySecLastCol = Cells(4, Columns.Count).End(xlToLeft).Column
'    Columns(mySecLastCol).Insert
'        'Ver1.1: Add in >15 to 30 Days
'        'Range(Cells(4, mySecLastCol + 1), Cells(8, mySecLastCol + 1)).Copy
'        Range(Cells(4, mySecLastCol + 1), Cells(9, mySecLastCol + 1)).Copy
'    Cells(4, mySecLastCol).PasteSpecial xlAll
'    Cells(4, mySecLastCol + 1).Value = "ww" & myCurWw
'    Cells(5, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">90"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
'    Cells(5, mySecLastCol + 1).Value = Cells(5, mySecLastCol + 1).Value
'    Cells(6, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
'    Cells(6, mySecLastCol + 1).Value = Cells(6, mySecLastCol + 1).Value
'    Cells(7, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
'    Cells(7, mySecLastCol + 1).Value = Cells(7, mySecLastCol + 1).Value
'        'Ver1.1: Add in >15 to 30 Days
'        Cells(8, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
'        Cells(8, mySecLastCol + 1).Value = Cells(8, mySecLastCol + 1).Value
'
'    'Third Table
'        'Ver1.1: Add in >15 to 30 Days
'        'Range(Cells(30, mySecLastCol + 1), Cells(34, mySecLastCol + 1)).Copy
'        Range(Cells(30, mySecLastCol + 1), Cells(35, mySecLastCol + 1)).Copy
'    Cells(30, mySecLastCol).PasteSpecial xlAll
'    Cells(30, mySecLastCol + 1).Value = "ww" & myCurWw
'    Cells(31, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">90"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
'    Cells(31, mySecLastCol + 1).Value = Cells(31, mySecLastCol + 1).Value
'    Cells(32, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
'    Cells(32, mySecLastCol + 1).Value = Cells(32, mySecLastCol + 1).Value
'    Cells(33, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
'    Cells(33, mySecLastCol + 1).Value = Cells(33, mySecLastCol + 1).Value
'        'Ver1.1: Add in >15 to 30 Days
'        Cells(34, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WO"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"") + COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WR"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
'        Cells(34, mySecLastCol + 1).Value = Cells(34, mySecLastCol + 1).Value
'    'Overall Table
'        'Ver1.1: Add in >15 to 30 Days
'        'Range(Cells(30, myFirstLastCol + 1), Cells(35, myFirstLastCol + 1)).Copy
'        Range(Cells(30, myFirstLastCol + 1), Cells(36, myFirstLastCol + 1)).Copy
'    Cells(30, myFirstLastCol).PasteSpecial xlAll
'    Cells(30, myFirstLastCol + 1).Value = "ww" & myCurWw
    
    
    If myCurMth <> myLastMth Then
        Do Until Cells(1 + myInc, myFirstLastCol).Value = ""
            Sheets("FF2 WS Aging").Cells(1 + myInc, myFirstLastCol).Value = myLastMth
            Sheets("FF2 WO+WR Aging ").Cells(1 + myInc, myFirstLastCol).Value = myLastMth
            myInc = myInc + 30
        Loop

        For myDelCount = myFirstLastCol - 1 To 1 Step -1
            If UCase(Left(Cells(1, myDelCount).Value, 2)) = "WW" Then
                Sheets("FF2 WS Aging").Cells(1, myDelCount).EntireColumn.Delete
                Sheets("FF2 WO+WR Aging ").Cells(1, myDelCount).EntireColumn.Delete
            End If
        Next myDelCount
    End If
    
    If myCurQtr <> myLastQtr Then
        myFirstLastCol = Range("B1").End(xlToRight).Column
        mySecLastCol = Cells(1, Columns.Count).End(xlToLeft).Column
        
        If UCase(Left(Cells(4, myFirstLastCol - 1).Value, 1)) = "Q" Or UCase(Left(Cells(4, myFirstLastCol - 1).Value, 1)) = "W" Then
            'SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "Unable to combine Month into Quarter.."
            Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to combine Month into Quarter..</html>", _
                        myAttachement(), _
                        0, 0)
            
            ActiveWorkbook.Close False
            GoTo myEnd
        Else
            myInc = 0
            Do Until Cells(1 + myInc, myFirstLastCol).Value = ""
                Sheets("FF2 WS Aging").Cells(1 + myInc, myFirstLastCol - 1).Value = myLastQtr
                Sheets("FF2 WO+WR Aging ").Cells(1 + myInc, myFirstLastCol - 1).Value = myLastQtr
                myInc = myInc + 30
            Loop
        End If
        
        For myDelCount = myFirstLastCol - 2 To 1 Step -1
            If UCase(Left(Cells(1, myDelCount).Value, 1)) = "Q" Or UCase(Left(Cells(1, myDelCount).Value, 1)) = "W" Then
                Exit For
            Else
                Sheets("FF2 WS Aging").Cells(4, myDelCount).EntireColumn.Delete
                Sheets("FF2 WO+WR Aging ").Cells(4, myDelCount).EntireColumn.Delete
            End If
        Next myDelCount
        
        For myDelCount = myFirstLastCol To 1 Step -1
            If Cells(1, myDelCount).EntireColumn.Hidden = True Then
                Cells(1, myDelCount + 1).EntireColumn.Hidden = True
                Exit For
            End If
        Next myDelCount
    End If
'        'ver1.1 Add in WS requested by EH on Feb 7 2023
'        Sheets("FF1 WS Aging").Select
'        myFirstLastCol = Range("B4").End(xlToRight).Column
'        Columns(myFirstLastCol).Insert
'
'        'First Table
'            'Ver1.1: Add in >15 to 30 Days
'            'Range(Cells(4, myFirstLastCol + 1), Cells(8, myFirstLastCol + 1)).Copy
'            Range(Cells(4, myFirstLastCol + 1), Cells(9, myFirstLastCol + 1)).Copy
'        Cells(4, myFirstLastCol).PasteSpecial xlAll
'        Cells(4, myFirstLastCol + 1).Value = "ww" & myCurWw
'        Cells(5, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
'        Cells(5, myFirstLastCol + 1).Value = Cells(5, myFirstLastCol + 1).Value
'        Cells(6, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
'        Cells(6, myFirstLastCol + 1).Value = Cells(6, myFirstLastCol + 1).Value
'        Cells(7, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
'        Cells(7, myFirstLastCol + 1).Value = Cells(7, myFirstLastCol + 1).Value
'            'Ver1.1: Add in >15 to 30 Days
'            Cells(8, myFirstLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,198,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
'            Cells(8, myFirstLastCol + 1).Value = Cells(8, myFirstLastCol + 1).Value
'
'        'Second Table
'        mySecLastCol = Cells(4, Columns.Count).End(xlToLeft).Column
'        Columns(mySecLastCol).Insert
'            'Ver1.1: Add in >15 to 30 Days
'            'Range(Cells(4, mySecLastCol + 1), Cells(8, mySecLastCol + 1)).Copy
'            Range(Cells(4, mySecLastCol + 1), Cells(9, mySecLastCol + 1)).Copy
'        Cells(4, mySecLastCol).PasteSpecial xlAll
'        Cells(4, mySecLastCol + 1).Value = "ww" & myCurWw
'        Cells(5, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
'        Cells(5, mySecLastCol + 1).Value = Cells(5, mySecLastCol + 1).Value
'        Cells(6, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
'        Cells(6, mySecLastCol + 1).Value = Cells(6, mySecLastCol + 1).Value
'        Cells(7, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
'        Cells(7, mySecLastCol + 1).Value = Cells(7, mySecLastCol + 1).Value
'            'Ver1.1: Add in >15 to 30 Days
'            Cells(8, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,318,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
'            Cells(8, mySecLastCol + 1).Value = Cells(8, mySecLastCol + 1).Value
'
'        'Third Table
'            'Ver1.1: Add in >15 to 30 Days
'            'Range(Cells(30, mySecLastCol + 1), Cells(34, mySecLastCol + 1)).Copy
'            Range(Cells(30, mySecLastCol + 1), Cells(35, mySecLastCol + 1)).Copy
'        Cells(30, mySecLastCol).PasteSpecial xlAll
'        Cells(30, mySecLastCol + 1).Value = "ww" & myCurWw
'        Cells(31, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">90"")"
'        Cells(31, mySecLastCol + 1).Value = Cells(31, mySecLastCol + 1).Value
'        Cells(32, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">60"",'[" & myRawAging & "]Temp'!$A:$A,""<91"")"
'        Cells(32, mySecLastCol + 1).Value = Cells(32, mySecLastCol + 1).Value
'        Cells(33, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">30"",'[" & myRawAging & "]Temp'!$A:$A,""<61"")"
'        Cells(33, mySecLastCol + 1).Value = Cells(33, mySecLastCol + 1).Value
'            'Ver1.1: Add in >15 to 30 Days
'            Cells(34, mySecLastCol + 1).Value = "=COUNTIFS('[" & myRawAging & "]Temp'!$C:$C,""WS"",'[" & myRawAging & "]Temp'!$F:$F,260,'[" & myRawAging & "]Temp'!$A:$A,"">15"",'[" & myRawAging & "]Temp'!$A:$A,""<31"")"
'            Cells(34, mySecLastCol + 1).Value = Cells(34, mySecLastCol + 1).Value
'        'Overall Table
'            'Ver1.1: Add in >15 to 30 Days
'            'Range(Cells(30, myFirstLastCol + 1), Cells(35, myFirstLastCol + 1)).Copy
'            Range(Cells(30, myFirstLastCol + 1), Cells(36, myFirstLastCol + 1)).Copy
'        Cells(30, myFirstLastCol).PasteSpecial xlAll
'        Cells(30, myFirstLastCol + 1).Value = "ww" & myCurWw
'
'
'        If myCurMth <> myLastMth Then
'            'Delete
'            Cells(30, myFirstLastCol).Value = myLastMth
'            Cells(30, mySecLastCol).Value = myLastMth
'            Cells(4, myFirstLastCol).Value = myLastMth
'            Cells(4, mySecLastCol).Value = myLastMth
'            For myDelCount = mySecLastCol - 1 To 1 Step -1
'                If UCase(Left(Cells(4, myDelCount).Value, 2)) = "WW" Then
'                    Cells(4, myDelCount).EntireColumn.Delete
'                Else
'                    Exit For
'                End If
'            Next myDelCount
'
'            For myDelCount = myFirstLastCol - 1 To 1 Step -1
'                If UCase(Left(Cells(4, myDelCount).Value, 2)) = "WW" Then
'                    Cells(4, myDelCount).EntireColumn.Delete
'                Else
'                    Exit For
'                End If
'            Next myDelCount
'        End If
'
'        If myCurQtr <> myLastQtr Then
'            myFirstLastCol = Range("B4").End(xlToRight).Column
'            mySecLastCol = Cells(4, Columns.Count).End(xlToLeft).Column
'
'            If UCase(Left(Cells(4, myFirstLastCol - 1).Value, 1)) = "Q" Or UCase(Left(Cells(4, myFirstLastCol - 1).Value, 1)) = "W" Or UCase(Left(Cells(4, mySecLastCol - 1).Value, 1)) = "Q" Or UCase(Left(Cells(4, mySecLastCol - 1).Value, 1)) = "W" Then
'                SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "Unable to combine Month into Quarter.."
'                ActiveWorkbook.Close False
'                GoTo myEnd
'            Else
'                Cells(4, myFirstLastCol - 1).Value = myLastQtr
'                Cells(30, myFirstLastCol - 1).Value = myLastQtr
'                Cells(4, mySecLastCol - 1).Value = myLastQtr
'                Cells(30, mySecLastCol - 1).Value = myLastQtr
'            End If
'
'            For myDelCount = mySecLastCol - 2 To 1 Step -1
'                If UCase(Left(Cells(4, myDelCount).Value, 1)) = "Q" Or UCase(Left(Cells(4, myDelCount).Value, 1)) = "W" Then
'                    Exit For
'                Else
'                    Cells(4, myDelCount).EntireColumn.Delete
'                End If
'            Next myDelCount
'
'            For myDelCount = myFirstLastCol - 2 To 1 Step -1
'                If UCase(Left(Cells(4, myDelCount).Value, 1)) = "Q" Or UCase(Left(Cells(4, myDelCount).Value, 1)) = "W" Then
'                    Exit For
'                Else
'                    Cells(4, myDelCount).EntireColumn.Delete
'                End If
'            Next myDelCount
'
'            myFirstLastCol = Range("B4").End(xlToRight).Column
'            mySecLastCol = Cells(4, Columns.Count).End(xlToLeft).Column
'            For myDelCount = mySecLastCol To 1 Step -1
'                If Cells(4, myDelCount).EntireColumn.Hidden = True Then
'                    Cells(4, myDelCount + 1).EntireColumn.Hidden = True
'                    Exit For
'                End If
'            Next myDelCount
'
'            For myDelCount = myFirstLastCol To 1 Step -1
'                If Cells(4, myDelCount).EntireColumn.Hidden = True Then
'                    Cells(4, myDelCount + 1).EntireColumn.Hidden = True
'                    Exit For
'                End If
'            Next myDelCount
'        End If
'        MasterFileSelect
'
'    ActiveWorkbook.Save
    mySaveFolderCheck = Dir(myMacroPath & "\Aging File\" & Year(Date), vbDirectory)
    If mySaveFolderCheck = "" Then
        MkDir myMacroPath & "\Aging File\" & Year(Date)
    End If
    Application.DisplayAlerts = False
        'Ver1.6: Save as common file
        ActiveWorkbook.SaveAs Filename:=myMacroPath & "\Aging File\" & Year(myLastDate + 7) & "\FF2 Aging.xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
    ActiveWorkbook.SaveAs Filename:=myMacroPath & "\Aging File\" & Year(myLastDate + 7) & "\FF2 Aging - " & Format(myLastDate + 7, "YYYYMMDD") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
    Application.DisplayAlerts = True
    
    Workbooks(myRawAging).Close False
    
    'Configuration file
    'ActiveWorkbook.Close False
    Workbooks.Open myMacroPath & "\FF2 WO Aging Report Configuration.xlsx", False, True
    'To
    If Sheets("To").Range("A1").Value <> "" Then
        If Sheets("To").Range("A2").Value <> "" Then
            myTempToTotal = Sheets("To").Range("A" & Rows.Count).End(xlUp).Row
            myTo = Join(Application.WorksheetFunction.Transpose(Sheets("To").Range("A1:A" & myTempToTotal).Value), ";")
        Else
            myTo = Sheets("To").Range("A1").Value
        End If
    End If
    'Cc
    If Sheets("Cc").Range("A1").Value <> "" Then
        If Sheets("Cc").Range("A2").Value <> "" Then
            myTempCcTotal = Sheets("Cc").Range("A" & Rows.Count).End(xlUp).Row
            myCc = Join(Application.WorksheetFunction.Transpose(Sheets("Cc").Range("A1:A" & myTempCcTotal).Value), ";")
        Else
            myCc = Sheets("Cc").Range("A1").Value
        End If
    End If
    If Sheets("Subject").Range("A1").Value <> "" Then
        mySubject = Sheets("Subject").Range("A1").Value
    End If
    If Sheets("Contents").Range("A1").Value <> "" Then
        myBody = Sheets("Contents").Range("A1").Value
    End If
    ActiveWorkbook.Close False
    
    'Sheets("FF2 WS Aging").Select
    
    For myB = 1 To 2
        myMpf = 1
        If myB = 1 Then
            Sheets("FF2 WO+WR Aging ").Select
        Else
            Sheets("FF2 WS Aging").Select
        End If
        
        
        Do Until Range("A" & myMpf).Value = ""
            mySuccess = ""
                'Ver1.3:
                'myName = Range("A" & myMpf).Value
                myName = Replace(Replace(Replace(Range("A" & myMpf).Value, " (", ""), ")", ""), "TOTAL", "")
            If myB = 1 Then
                myPic = "Chart" & myName & "WOWR"
            Else
                myPic = "Chart" & myName & "WS"
            End If
            ActiveSheet.ChartObjects(myPic).Activate
            If ActiveChart.HasTitle = True Then
                'Ver1.3
                'ActiveChart.ChartTitle.Text = Range("B" & myMpf + 7).Value
                ActiveChart.ChartTitle.Text = Range("B" & myMpf + 9).Value
            Else
                ActiveChart.HasTitle = True
                'Ver1.3
                'ActiveChart.ChartTitle.Text = Range("B" & myMpf + 7).Value
                ActiveChart.ChartTitle.Text = Range("B" & myMpf + 9).Value
            End If
            ActiveSheet.ChartObjects(myPic).Activate
            For myA = 1 To 20
                ErrorHandler1
                If mySuccess = "Yes" Then Exit For
            Next myA
            If mySuccess = "" Then
                'SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "Unable to send email!"
                Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to create image</html>", _
                        myAttachement(), _
                        0, 0)
                
                ActiveWorkbook.Close False
                GoTo myEnd
            End If
            
            Sheets.Add
            Application.Wait (Now + TimeValue("00:00:01"))
            ActiveSheet.Range("I1").PasteSpecial
            'Application.Range(Cells(4, 1), Cells(myLastRow, myLastCol)).CopyPicture Appearance:=xlScreen, Format:=xlPicture
            Application.Wait (Now + TimeValue("00:00:01"))
            
            myObject = Selection.Name
            Selection.ShapeRange.PictureFormat.Contrast = 0.5:
            Selection.ShapeRange.PictureFormat.Brightness = 1:
            Selection.ShapeRange.PictureFormat.ColorType = msoPictureAutomatic:
            Selection.ShapeRange.PictureFormat.TransparentBackground = msoFalse:
            Selection.ShapeRange.Fill.Visible = msoFalse:
            Selection.ShapeRange.Line.Visible = msoFalse:
            Selection.ShapeRange.Rotation = 0#:
            Selection.ShapeRange.PictureFormat.CropLeft = 0#:
            Selection.ShapeRange.PictureFormat.CropRight = 0#:
            Selection.ShapeRange.PictureFormat.CropTop = 0#:
            Selection.ShapeRange.PictureFormat.CropBottom = 0#:
            Selection.ShapeRange.ScaleHeight 1#, msoTrue, msoScaleFromTopLeft:
            Selection.ShapeRange.ScaleWidth 1#, msoTrue, msoScaleFromTopLeft
            Application.Wait (Now + TimeValue("00:00:01"))
            Application.Selection.CopyPicture Appearance:=xlScreen, Format:=xlPicture
            Set oDia = ActiveSheet.ChartObjects.Add(0, 0, ActiveSheet.Shapes(1).Width, ActiveSheet.Shapes(1).Height)
            'ActiveSheet.Shapes("Chart 1").Line.Visible = msoFalse
            Set oChartArea = oDia.Chart
            oDia.Activate
            oChartArea.ChartArea.Select
            oChartArea.Paste
            oChartArea.Export (myMacroPath & "\" & myPic & ".jpg")
            
            Application.DisplayAlerts = False
            ActiveSheet.Delete
            Application.DisplayAlerts = True
            myMpf = Range("A" & myMpf).End(xlDown).Row
            'Ver1.3:
            If Left(Range("A" & myMpf).Value, 5) = "TOTAL" Then
                myMpf = Range("A" & myMpf).End(xlDown).Row
            End If
        Loop
    Next myB
    
    'Ver1.1: Add in WS Picture
'    Sheets("FF1 WS Aging").Select
'    For myCounterB = 1 To 4
'        mySuccess = ""
'        myPic = "Chart " & myCounterB
'        ActiveSheet.ChartObjects(myPic).Activate
'        For myA = 1 To 20
'            ErrorHandler1
'            If mySuccess = "Yes" Then Exit For
'        Next myA
'        If mySuccess = "" Then
'            SendEmail "sk.loon@plexus.com", "", "Error: FF2 WO Aging Report Creator", "Unable to send email!"
'            ActiveWorkbook.Close False
'            GoTo myEnd
'        End If
'
'        Sheets.Add
'        Application.Wait (Now + TimeValue("00:00:01"))
'        ActiveSheet.Range("I1").PasteSpecial
'        'Application.Range(Cells(4, 1), Cells(myLastRow, myLastCol)).CopyPicture Appearance:=xlScreen, Format:=xlPicture
'        Application.Wait (Now + TimeValue("00:00:01"))
'
'        myObject = Selection.Name
'        Selection.ShapeRange.PictureFormat.Contrast = 0.5:
'        Selection.ShapeRange.PictureFormat.Brightness = 1:
'        Selection.ShapeRange.PictureFormat.ColorType = msoPictureAutomatic:
'        Selection.ShapeRange.PictureFormat.TransparentBackground = msoFalse:
'        Selection.ShapeRange.Fill.Visible = msoFalse:
'        Selection.ShapeRange.Line.Visible = msoFalse:
'        Selection.ShapeRange.Rotation = 0#:
'        Selection.ShapeRange.PictureFormat.CropLeft = 0#:
'        Selection.ShapeRange.PictureFormat.CropRight = 0#:
'        Selection.ShapeRange.PictureFormat.CropTop = 0#:
'        Selection.ShapeRange.PictureFormat.CropBottom = 0#:
'        Selection.ShapeRange.ScaleHeight 1#, msoTrue, msoScaleFromTopLeft:
'        Selection.ShapeRange.ScaleWidth 1#, msoTrue, msoScaleFromTopLeft
'        Application.Wait (Now + TimeValue("00:00:01"))
'            Application.Selection.CopyPicture Appearance:=xlScreen, Format:=xlPicture
'            Set oDia = ActiveSheet.ChartObjects.Add(0, 0, ActiveSheet.Shapes(1).Width, ActiveSheet.Shapes(1).Height)
'            'ActiveSheet.Shapes("Chart 1").Line.Visible = msoFalse
'            Set oChartArea = oDia.Chart
'        oDia.Activate
'        oChartArea.ChartArea.Select
'        oChartArea.Paste
'        If myCounterB = 1 Then
'            oChartArea.Export (myMacroPath & "\Termag-WS.jpg")
'        ElseIf myCounterB = 2 Then
'            oChartArea.Export (myMacroPath & "\Terady-WS.jpg")
'        ElseIf myCounterB = 3 Then
'            oChartArea.Export (myMacroPath & "\Teradyne-WS.jpg")
'        ElseIf myCounterB = 4 Then
'            oChartArea.Export (myMacroPath & "\HDD-WS.jpg")
'        End If
'        Application.DisplayAlerts = False
'        ActiveSheet.Delete
'        Application.DisplayAlerts = True
'    Next myCounterB
    
'    With CreateObject("Outlook.Application").CreateItem(0)
'        .SentOnBehalfOfName = "PLXS-MFG.IslandView.SystemAnalyticalAutomation@plexus.com"
'        .To = myTo
'        .Cc = myCc
'        .Bcc = "Sk.loon@plexus.com"
'        .Subject = Replace(mySubject, "WW", "WW" & myCurWw)
''        .Attachments.Add myMacroPath & "\Teradyne.jpg"
''        .Attachments.Add myMacroPath & "\Termag.jpg"
''        .Attachments.Add myMacroPath & "\Terady.jpg"
''        .Attachments.Add myMacroPath & "\HDD.jpg"
'
'        myMpf = 1
'        Do Until Range("A" & myMpf).Value = ""
'            'Ver1.3:
'            'myName = Range("A" & myMpf).Value
'            myName = Replace(Replace(Replace(Range("A" & myMpf).Value, " (", ""), ")", ""), "TOTAL", "")
'
'            .Attachments.Add myMacroPath & "\Chart" & myName & "WOWR.jpg"
'            .Attachments.Add myMacroPath & "\Chart" & myName & "WS.jpg"
'            myEmailCode = myEmailCode & "<html><br><img src=cid:Chart" & myName & "WOWR.jpg></img><img src=cid:Chart" & myName & "WS.jpg></img>"
'            myMpf = Range("A" & myMpf).End(xlDown).Row
'            'Ver1.3:
'            If Left(Range("A" & myMpf).Value, 5) = "TOTAL" Then
'                myMpf = Range("A" & myMpf).End(xlDown).Row
'            End If
'        Loop
''        '
''        .Attachments.Add myMacroPath & "\Teradyne-WS.jpg"
''        .Attachments.Add myMacroPath & "\Termag-WS.jpg"
''        .Attachments.Add myMacroPath & "\Terady-WS.jpg"
''        .Attachments.Add myMacroPath & "\HDD-WS.jpg"
'
'        '.Attachments.Add "\\pena-dsk-601\ISL_General\01.Magnum\MCC\MACRO WIP\" & Format(myLastDate + 14, "Yyyy") & "\" & Format(myLastDate + 14, "Mmm") & "\Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx"
'        .Attachments.Add "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\MACRO WIP\" & Format(myLastDate + 14, "Yyyy") & "\" & Format(myLastDate + 14, "Mmm") & "\Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx"
'            .Attachments.Add myMacroPath & "\Aging File\" & Year(myLastDate + 7) & "\FF2 Aging.xlsx"
'
'
'        .HTMLBody = "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>" & Replace(Replace(myBody, "WW", "WW" & myCurWw), Chr(10), "<br>") & _
'                  myEmailCode & _
'                  "<p>" & _
'                  mySignature & "</p></BODY>© Copyright Plexus Islandview 2023. All rights reserved. <a href='mailto:PLXS-MFG.IslandView.SystemAnalyticalAutomation@plexus.com?subject=Unsubscribe FF2 WO Aging Report'>Unsubscribe</a> | <a href='mailto:PLXS-MFG.IslandView.SystemAnalyticalAutomation@plexus.com?subject=Subscribe FF2 WO Aging Report'>Subscribe</a></html>"
'                  '.HTMLBody = "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>" & Replace(myBody, "WW", "WW" & myWwEnd) & _
'                  "<html>" & RangetoHTML(Range("B3", Cells(9, myLastCol))) & _
'                  "<html><br><br><img src=cid:Temp.jpg></img>" & _
'                  "<p>" & _
'                  mySignature & "</p></BODY></html>"
'
'        .Display
'        .Send
'    End With
        
        'myAllMpf = ((((Application.WorksheetFunction.CountA(Columns("A:A")) - 1) / 2) + 1) * 2) + 1
        myAllMpf = ((((Application.WorksheetFunction.CountA(Columns("A:A")) - 1) / 2) + 1) * 2) + 2
        ReDim myAttachement(myAllMpf)
        myMpf = 1
        myArr = 0
        myEmailCode = ""
        Do Until Range("A" & myMpf).Value = ""
            'Ver1.3:
            'myName = Range("A" & myMpf).Value
            myName = Replace(Replace(Replace(Range("A" & myMpf).Value, " (", ""), ")", ""), "TOTAL", "")

            '.Attachments.Add myMacroPath & "\Chart" & myName & "WOWR.jpg"
            '.Attachments.Add myMacroPath & "\Chart" & myName & "WS.jpg"
            myEmailCode = myEmailCode & "<html><br><img src=cid:Image" & myArr + 1 & "></img><img src=cid:Image" & myArr + 2 & "></img>"
            myMpf = Range("A" & myMpf).End(xlDown).Row
            'Ver1.3:
            If Left(Range("A" & myMpf).Value, 5) = "TOTAL" Then
                myMpf = Range("A" & myMpf).End(xlDown).Row
            End If
            myAttachement(myArr) = myMacroPath & "\Chart" & myName & "WOWR.jpg"
            myAttachement(myArr + 1) = myMacroPath & "\Chart" & myName & "WS.jpg"
            myArr = myArr + 2
        Loop
        myAttachement(myArr + 1) = "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\MACRO WIP\" & Format(myLastDate + 14, "Yyyy") & "\" & Format(myLastDate + 14, "Mmm") & "\Aging " & Format(myLastDate + 14, "MmDdYyyy") & ".xlsx"
        myAttachement(myArr + 2) = myMacroPath & "\Aging File\" & Year(myLastDate + 7) & "\FF2 Aging.xlsx"
        ActiveWorkbook.Close False
        Call SendSmtpEmail( _
                    "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                    myTo & "", _
                    myCc & "", _
                    "sk.loon@plexus.com", _
                    Replace(mySubject, "WW", "WW" & myCurWw), _
                    "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>" & Replace(Replace(myBody, "WW", "WW" & myCurWw), Chr(10), "<br>") & myEmailCode, _
                    myAttachement(), _
                    myAllMpf + 1, myAllMpf + 1)
    
    'ActiveWorkbook.Close False
    
myEnd:
    'Workbooks("Configuration-198.xlsx").Close False
    'Workbooks(myMacroFile).Save
    Application.Quit
    'myEndTime = Time
    'MsgBox "Done in " & Format(myEndTime - myStrTime, "HH:MM:SS")
End Sub
Sub ErrorHandler1()
    On Error GoTo myFail
    'Selection.CopyPicture Appearance:=xlScreen, Format:=xlPicture 'Need error handler
    Selection.CopyPicture Appearance:=xlScreen, Format:=xlBitmap  'Need error handler
    'Selection.Copy
    mySuccess = "Yes"
    Exit Sub
myFail:
End Sub
Sub SendEmail(myTo As String, myCc As String, mySubject As String, myBody As String)
     With CreateObject("Outlook.Application").CreateItem(0)
        .To = myTo
        .Cc = myCc
        .Subject = mySubject
        .HTMLBody = "<html><p>" & myBody
        .Send
    End With
End Sub
Function RangetoHTML(rng As Range)

    Dim fso As Object
    Dim ts As Object
    Dim TempFile As String
    Dim TempWB As Workbook

    TempFile = Environ$("temp") & "\" & Format(Now, "dd-mm-yy h-mm-ss") & ".htm"

    'Copy the range and create a new workbook to past the data in
    rng.Copy
    Set TempWB = Workbooks.Add(1)
    With TempWB.Sheets(1)
        .Cells(1).PasteSpecial Paste:=8
        .Cells(1).PasteSpecial xlPasteValues, , False, False
        .Cells(1).PasteSpecial xlPasteFormats, , False, False
        .Cells(1).Select
        Application.CutCopyMode = False
        On Error Resume Next
        .DrawingObjects.Visible = True
        .DrawingObjects.Delete
        On Error GoTo 0
    End With

    'Publish the sheet to a htm file
    With TempWB.PublishObjects.Add( _
         SourceType:=xlSourceRange, _
         Filename:=TempFile, _
         Sheet:=TempWB.Sheets(1).Name, _
         Source:=TempWB.Sheets(1).UsedRange.Address, _
         HtmlType:=xlHtmlStatic)
        .Publish (True)
    End With

    'Read all data from the htm file into RangetoHTML
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set ts = fso.GetFile(TempFile).OpenAsTextStream(1, -2)
    RangetoHTML = ts.ReadAll
    ts.Close
    RangetoHTML = Replace(RangetoHTML, "align=center x:publishsource=", "align=left x:publishsource=")

    'Close TempWB
    Application.EnableEvents = False
    TempWB.Close savechanges:=False
    Application.EnableEvents = True

    'Delete the htm file we used in this function
    Kill TempFile

    Set ts = Nothing
    Set fso = Nothing
    Set TempWB = Nothing
End Function
Sub DeleteSum()
    On Error Resume Next
    Application.DisplayAlerts = False
    Sheets("Summ").Delete
    Application.DisplayAlerts = False
End Sub
Sub NewFileSelect()
    On Error GoTo NewError
    Workbooks(Range("F18").Value).Activate
    Exit Sub
NewError:
    MsgBox Range("F18").Value & " file not found!"
    End
End Sub
Sub FileClose()
    On Error Resume Next
    Application.DisplayAlerts = False
    Workbooks("FML.xlsx").Close False
    Application.DisplayAlerts = True
End Sub
Sub DeleteCustomer()
    On Error Resume Next
    Application.DisplayAlerts = False
    Sheets("Details Shortage_Customer").Delete
    Application.DisplayAlerts = True
End Sub
Sub DeleteTemp()
    On Error Resume Next
    Application.DisplayAlerts = False
    Sheets("WOCT").Delete
    Application.DisplayAlerts = True
End Sub
Sub DeleteTempTemp()
    On Error Resume Next
    Application.DisplayAlerts = False
    Sheets("TempTemp").Delete
    Application.DisplayAlerts = True
End Sub
Sub MasterFileSelect()
    On Error GoTo AgingError
    Sheets("FF2 WO+WR Aging ").Select
    Exit Sub
AgingError:

End Sub
Sub SendSmtpEmail(myFrom As String, myTo As String, myCc As String, myBcc As String, mySubject As String, myBody As String, myAttachment() As String, myTotalAtt As Integer, myTotalEmb As Integer)
    Dim iMsg As Object
    Dim iConf As Object
    Dim Flds As Variant
    Dim CDOMessage As Object
    Dim Configuration As Object

    
    Set iMsg = CreateObject("CDO.Message")
    Set iConf = CreateObject("CDO.Configuration")
    'i = 100
    iConf.Load -1 ' CDO Source Defaults
    Set Flds = iConf.Fields
    With Flds
        .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
        .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = "internet-smtp.plexus.com"
        .Item("http://schemas.microsoft.com/cdo/configuration/smtpserverport") = 25
        .Update
    End With
    
    With iMsg
        Set .Configuration = iConf
        .From = myFrom '"PLXS-MFG Bangkok SystemAnalyticalAutomation <PLXS-MFG.Bangkok.SystemAnalyticalAutomation@plexus.com>"
        .To = myTo '"sk.loon@plexus.com"
        .Cc = myCc
        .Bcc = myBcc
        For myA = 1 To myTotalAtt
            .AddAttachment myAttachment(myA - 1)
        Next myA
        For myB = 1 To myTotalEmb
            Set iBp = .Attachments.Item(myB)
            iBp.Fields.Item("urn:schemas:mailheader:content-id") = "Image" & myB
            iBp.Fields.Update
        Next myB
        .Subject = mySubject
        .HTMLBody = myBody
        .Send
    End With
    
    Set iMsg = Nothing
    Set iConf = Nothing
    Set Flds = Nothing
End Sub
'Function RangetoHTML(rng As Range)
'
'    Dim fso As Object
'    Dim ts As Object
'    Dim TempFile As String
'    Dim TempWB As Workbook
'
'    On Error GoTo myQuit
'    TempFile = Environ$("temp") & "\" & Format(Now, "dd-mm-yy h-mm-ss") & ".htm"
'
'    'Copy the range and create a new workbook to past the data in
'    rng.Copy
'    Set TempWB = Workbooks.Add(1)
'    With TempWB.Sheets(1)
'        Application.Wait (Now + TimeValue("00:00:01"))
'        .Cells(1).PasteSpecial Paste:=8
'        Application.Wait (Now + TimeValue("00:00:01"))
'        .Cells(1).PasteSpecial xlPasteValues, , False, False
'        Application.Wait (Now + TimeValue("00:00:01"))
'        .Cells(1).PasteSpecial xlPasteFormats, , False, False
'        Application.Wait (Now + TimeValue("00:00:01"))
'        .Cells(1).Select
'        Application.Wait (Now + TimeValue("00:00:01"))
'        Application.CutCopyMode = False
'        On Error Resume Next
'        Application.Wait (Now + TimeValue("00:00:01"))
'        .DrawingObjects.Visible = True
'        Application.Wait (Now + TimeValue("00:00:01"))
'        .DrawingObjects.Delete
'        Application.Wait (Now + TimeValue("00:00:01"))
'        On Error GoTo 0
'    End With
'    Application.Wait (Now + TimeValue("00:00:01"))
'
'    'Publish the sheet to a htm file
'    With TempWB.PublishObjects.Add( _
'         SourceType:=xlSourceRange, _
'         Filename:=TempFile, _
'         Sheet:=TempWB.Sheets(1).Name, _
'         Source:=TempWB.Sheets(1).UsedRange.Address, _
'         HtmlType:=xlHtmlStatic)
'        .Publish (True)
'    End With
'
'    'Read all data from the htm file into RangetoHTML
'    Set fso = CreateObject("Scripting.FileSystemObject")
'    Set ts = fso.GetFile(TempFile).OpenAsTextStream(1, -2)
'    Application.Wait (Now + TimeValue("00:00:01"))
'    RangetoHTML = ts.ReadAll
'    Application.Wait (Now + TimeValue("00:00:01"))
'    ts.Close
'    Application.Wait (Now + TimeValue("00:00:01"))
'    RangetoHTML = Replace(RangetoHTML, "align=center x:publishsource=", "align=left x:publishsource=")
'    Application.Wait (Now + TimeValue("00:00:01"))
'
'    'Close TempWB
'    TempWB.Close savechanges:=False
'    Application.Wait (Now + TimeValue("00:00:01"))
'
'    'Delete the htm file we used in this function
'    Kill TempFile
'    Application.Wait (Now + TimeValue("00:00:01"))
'
'    Set ts = Nothing
'    Set fso = Nothing
'    Set TempWB = Nothing
'myQuit:
'End Function
'
