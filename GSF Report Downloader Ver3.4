Private Const IDC_WAIT As Long = 32514

Private Type POINT
    x As Long
    y As Long
End Type

Private Type CURSORINFO
    cbSize As Long
    flags As Long
    hCursor As Long
    ptScreenPos As POINT
End Type

Private Declare Function GetCursorInfo Lib "user32" (ByRef pci As CURSORINFO) As Boolean
Private Declare Function LoadCursor Lib "user32" Alias "LoadCursorA" (ByVal hInstance As Long, ByVal lpCursorName As Long) As Long


Public Declare Function SetCursorPos Lib "user32" (ByVal x As Long, ByVal y As Long) As Long
Public Declare Sub mouse_event Lib "user32" (ByVal dwFlags As Long, ByVal dx As Long, ByVal dy As Long, ByVal cButtons As Long, ByVal dwExtraInfo As Long)
Public Const MOUSEEVENTF_LEFTDOWN = &H2
Public Const MOUSEEVENTF_LEFTUP = &H4
Public Const MOUSEEVENTF_RIGHTDOWN As Long = &H8
Public Const MOUSEEVENTF_RIGHTUP As Long = &H10
Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Long
' Create custom variable that holds two integers
Type POINTAPI
   Xcoord As Long
   Ycoord As Long
End Type
Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
'Private Declare Function FindWindow Lib "user32" Alias "FindWindowA" (ByVal lpClassName As String, ByVal lpWindowName As String) As Long
'Private Declare Function PostMessage Lib "user32" Alias "PostMessageA" (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, lParam As Any) As Long
Private Const WM_CLOSE = &H10
Public Declare Function SetForegroundWindow Lib "user32" (ByVal hWnd As Long) As Long
Private Declare Function ShowWindow Lib "user32" (ByVal hWnd As Long, ByVal nCmdSHow As Long) As Long
Public Declare Function ShellExecute Lib "shell32.dll" Alias "ShellExecuteA" (ByVal hWnd As Long, ByVal lpOperation As String, ByVal lpFile As String, ByVal lpParameters As String, ByVal lpDirectory As String, ByVal nShowCmd As Long) As Long
Private Declare Function FindWindow Lib "user32" Alias "FindWindowA" (ByVal lpClassName As String, ByVal lpWindowName As String) As Long
Private Declare Function PostMessage Lib "user32" Alias "PostMessageA" (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal lParam As Long) As Long
Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal lParam As Long) As Long
Private Declare Function SendMessageByString Lib "user32" Alias "SendMessageA" (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal lParam As String) As Long
Private Declare Function SendMessageLong& Lib "user32" Alias "SendMessageA" (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal lParam As Long)
Private Declare Function FindWindowEx Lib "user32" Alias "FindWindowExA" (ByVal hWnd1 As Long, ByVal hWnd2 As Long, ByVal lpsz1 As String, ByVal lpsz2 As String) As Long
Dim myAttachement() As String
Sub SendEmail(myTo As String, mySubject As String, myBody As String)
    With CreateObject("Outlook.Application").CreateItem(0)
        .To = myTo
        .Subject = mySubject
        .HTMLBody = "<html><p>" & myBody & "<p>" & _
                  "<br>This is an auto generated email no reply required</p></html>"
        .Send
    End With
End Sub
Sub GsfDownloader()
    'Ver3.0: Check for file availability
    myMonth = Format(Date, "Mmm")
    myYear = Format(Date, "Yyyy")
    myDate = Format(Date, "MMDDYYYY")
    myIslFile = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\" & myYear & "\" & myMonth & "\Serial Number Aging 318-" & myDate & ".xlsx", vbNormal)
    'Ver3.4:
    'mySeaFile = Dir("\\ap\mfg\PenaData\Apps_Integration\SEA_SystemAnalyticalAutomation\WIP_Report\" & myYear & "\" & myMonth & "\Serial Number Aging 571-" & myDate & ".xlsx", vbNormal)
    'myBgkFile = Dir("\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear & "\" & myMonth & "\Serial Number Aging 869-" & myDate & ".xlsx", vbNormal)
    mySeaFile = Dir("\\ap\mfg\PenaData\Apps_Integration\SEA_SystemAnalyticalAutomation\WIP_Report\" & myYear & "\" & myMonth & "\Serial Number Aging Seaside " & myDate & ".xlsx", vbNormal)
    myBgkFile = Dir("\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear & "\" & myMonth & "\Serial Number Aging Bangkok " & myDate & ".xlsx", vbNormal)
    
    If myIslFile <> "" And mySeaFile <> "" And myBgkFile <> "" Then GoTo myEnd
    Dim fso As Scripting.FileSystemObject
    ReDim myAttachement(0)
    Dim llCoord As POINTAPI
    Dim handleWaitCursor As Long
    Dim pci As CURSORINFO
    Dim ret As Boolean
    Dim BufObj As MSForms.DataObject
    Dim lngRet As Long
    Dim Pid As Long
    Dim Winwedgedl As Long
    myMacrofile = ActiveWorkbook.Name
    myMacroPath = ActiveWorkbook.Path
    myMonthYear = Format(Date, "MM. MmmYYYY")
    Set fso = CreateObject("Scripting.FileSystemObject")
    Const BM_CLICK As Long = &HF5&
    Const WM_SETTEXT As Long = &HC
    Const CB_SHOWDROPDOWN = 335
    Set BufObj = New MSForms.DataObject
myRetry:
'    myFile = Dir(myMacroPath & "\Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx")
'    If myFile <> "" Then
'        Kill myMacroPath & "\Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx"
'    End If
'
'    'Ver3.0:
'    myFile = Dir(myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx")
'    If myFile <> "" Then
'        Kill myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx"
'    End If
'    myFile = Dir(myMacroPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx")
'    If myFile <> "" Then
'        Kill myMacroPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx"
'    End If
        
    strFile = "C:\GSFPD\PLXS.GSF.UI.exe"  ' the file you want to open/etc.
    strAction = "OPEN"  ' action might be OPEN, NEW or other, depending on what you need to do
    lngErr = ShellExecute(0, strAction, strFile, "", "", 0)
    Application.Wait (Now + TimeValue("00:00:15"))
    
    'Ver1.7: Check for update
    myFindWnd = FindWindow("#32770", "")
    If myFindWnd > 0 Then
        TextBoxHandle = FindWindowEx(myFindWnd, 0&, "Button", "OK")
        PostMessage TextBoxHandle, BM_CLICK, 0, 0
        Application.Wait (Now + TimeValue("00:01:00"))
        hwndParent = FindWindow(vbNullString, "GSF Client Updater")
        Do Until hwndParent = 0
            Application.Wait (Now + TimeValue("00:01:00"))
            hwndParent = FindWindow(vbNullString, "GSF Client Updater")
        Loop
    End If
    
    'Ver1.4 Get pass from share folder
        'Range("A1").Value = "='T:\Others\Macro_Backup\Info\[Book1.xlsm]Macro'!$B$4"
        Range("A1").Value = "='\\ap\mfg\PenaData\ISL\Purchasing_Mat_Planning\_Restricted\Automation\Macro_Backup\Info\[Book1.xlsm]Macro'!$B$4"
    'Ver1.9:
    'myPass = Replace(Replace(Replace(Replace(Range("A1").Value, "^", "{^}"), "%", "{%}"), "+", "{+}"), "~", "{~}")
    myPass = Replace(Replace(Range("A1").Value, "+", "{+}"), "~", "{~}")
    Range("A1").ClearContents
    
    Application.Wait (Now + TimeValue("00:00:15"))
myRetryLogin:
    For myCounter = 1 To 100
        Application.Wait (Now + TimeValue("00:00:10"))
        hwndParent = FindWindow(vbNullString, "Global Shop Floor")
        If hwndParent <> 0 Then
            Exit For
        End If
    Next myCounter
    If myCounter > 100 Then
        'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find login page...")
        Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find login page...</html>", _
                myAttachement(), _
                0, 0)
        GoTo myEnd
    End If
    
    Application.Wait (Now + TimeValue("00:00:01"))
    'Username
    hwndParent = FindWindow(vbNullString, "Global Shop Floor")
    
    'VEr2.5: Get Windows number
    For myA = 1 To 50
        myWnd = FindWindowEx(hwndParent, 0&, "WindowsForms10.Window.8.app.0.30495d1_r" & myA & "_ad1", vbNullString)
        If myWnd > 0 Then
            myWnd = myA
            Exit For
        End If
        
    Next myA
    If myWnd = 0 Then
        'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find login screen.")
        Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find login screen.</html>", _
                myAttachement(), _
                0, 0)
        
        GoTo myEnd
    End If
    'TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    'TextBoxHandle1 = FindWindowEx(hwndParent, TextBoxHandle, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    'TextBoxHandle2 = FindWindowEx(hwndParent, TextBoxHandle1, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    'TextBoxHandle3 = FindWindowEx(hwndParent, TextBoxHandle2, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    'TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "WindowsForms10.EDIT.app.0.30495d1_r9_ad1", vbNullString)
    TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle1 = FindWindowEx(hwndParent, TextBoxHandle, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle2 = FindWindowEx(hwndParent, TextBoxHandle1, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle3 = FindWindowEx(hwndParent, TextBoxHandle2, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "WindowsForms10.EDIT.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    
    'VEr2.5:
    'If TextBoxHandle4 = "" Then
    If TextBoxHandle4 = 0 Then
        'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find User Name Textbox.")
        Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find User Name Textbox.</html>", _
                myAttachement(), _
                0, 0)
        
        GoTo myEnd
    Else
        SendMessageByString TextBoxHandle4, WM_SETTEXT, 0, "AP\sk.loon"
    End If
    
    'Password
    'VEr2.5:
    'TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    '                                            ''WindowsForms10.Window.8.app.0.30495d1_r14_ad1
    'TextBoxHandle1 = FindWindowEx(hwndParent, TextBoxHandle, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    'TextBoxHandle2 = FindWindowEx(hwndParent, TextBoxHandle1, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    'TextBoxHandle3 = FindWindowEx(TextBoxHandle2, 0&, "WindowsForms10.EDIT.app.0.30495d1_r9_ad1", vbNullString
    TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle1 = FindWindowEx(hwndParent, TextBoxHandle, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle2 = FindWindowEx(hwndParent, TextBoxHandle1, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle3 = FindWindowEx(TextBoxHandle2, 0&, "WindowsForms10.EDIT.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    
    'VEr2.5:
    'If TextBoxHandle3 = "" Then
    If TextBoxHandle3 = 0 Then
        'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Password Textbox.")
        Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Password Textbox.</html>", _
                myAttachement(), _
                0, 0)
        
        GoTo myEnd
    Else
        SendMessageByString TextBoxHandle3, WM_SETTEXT, 0, myPass
    End If
    
    'VEr2.5:
    ''Login
    'TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", vbNullString)
    'TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", "")
    ''TextBoxHandle2 = FindWindowEx(TextBoxHandle, TextBoxHandle1, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", "")
    'Login
    TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
    TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", "")
    
    'VEr2.5:
    'If TextBoxHandle1 = "" Then
    If TextBoxHandle1 = 0 Then
        'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Login button.")
        Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Login button.</html>", _
                myAttachement(), _
                0, 0)
        
        GoTo myEnd
    Else
        PostMessage TextBoxHandle1, &H201, 0&, 0& 'WM_LBUTTONDOWN = &H201
        PostMessage TextBoxHandle1, &H202, 0&, 0& 'WM_LBUTTONUP = &H202
    End If
    Application.Wait (Now + TimeValue("00:00:20"))
    
    'Missing Information
    hwndMissingInfoParent = FindWindow(vbNullString, "Missing Information")
    If hwndMissingInfoParent <> 0 Then
        SendMessage hwndMissingInfoParent, WM_CLOSE, 0, 0 'Close WMS
        myMissingCounter = myMissingCounter + 1
        If myMissingCounter > 3 Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Missing information at the login.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Missing information at the login.</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        Else
            GoTo myRetryLogin
        End If
    End If
    
    'Ver3.0: Adding Bangkok
    'For myX = 1 To 2
    For myX = 1 To 3
        'Ver3.0: Set WS
        If myX = 1 Then
            'VEr1.3: Include WS in the Work Order
            Application.Wait (Now + TimeValue("00:00:01"))
            SetCursorPos 413, 184 'Work Order Drop Down
            Application.Wait (Now + TimeValue("00:00:02"))
            mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            Application.Wait (Now + TimeValue("00:00:08"))
            
            SendKeys ("{DOWN}{DOWN}{DOWN}") 'Select WS
            Application.Wait (Now + TimeValue("00:00:03"))
            
            SendKeys (" ") 'Select WS
            Application.Wait (Now + TimeValue("00:00:08"))
            
            'Select Header to apply the effect of selecing WS
            SetCursorPos 413, 65 'Searial Number Aging
            Application.Wait (Now + TimeValue("00:00:02"))
            mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            Application.Wait (Now + TimeValue("00:00:05"))
            mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            Application.Wait (Now + TimeValue("00:00:02"))
        End If
        If myX = 1 And myIslFile <> "" Then GoTo myNext
        If myX = 2 And mySeaFile <> "" Then GoTo myNext
        If myX = 3 And myBgkFile <> "" Then GoTo myNext
        If myX = 1 Then
            myFile = Dir(myMacroPath & "\Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx")
            If myFile <> "" Then
                Kill myMacroPath & "\Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx"
            End If
        ElseIf myX = 2 Then
            myFile = Dir(myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx")
            If myFile <> "" Then
                Kill myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx"
            End If
        Else
                myFile = Dir(myMacroPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx")
            If myFile <> "" Then
                Kill myMacroPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx"
            End If
        End If
        
        'Global Shop Floor - PROD
        'hwndParent = FindWindow(vbNullString, "Global Shop Floor - PROD - [Serial Number Aging]")
        hwndParent = FindWindow(vbNullString, "Global Shop Floor - PROD")
        For myCounter = 1 To 100
            Application.Wait (Now + TimeValue("00:00:01"))
            hwndParent = FindWindow(vbNullString, "Global Shop Floor - PROD")
            If hwndParent <> 0 Then
                Exit For
            End If
        Next myCounter
        Application.Wait (Now + TimeValue("00:00:05"))
        
        'Cater for Seaside
        If myX = 1 Then
            'Ver3.0: Set at beginning
            ''VEr1.3: Include WS in the Work Order
            'Application.Wait (Now + TimeValue("00:00:01"))
            'SetCursorPos 413, 184 'Work Order Drop Down
            'Application.Wait (Now + TimeValue("00:00:02"))
            'mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            'mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            'Application.Wait (Now + TimeValue("00:00:08"))
            '
            'SendKeys ("{DOWN}{DOWN}{DOWN}") 'Select WS
            'Application.Wait (Now + TimeValue("00:00:03"))
            '
            'SendKeys (" ") 'Select WS
            'Application.Wait (Now + TimeValue("00:00:08"))
        ElseIf myX = 2 Then
            'Ver3.0: Will be execute at the end of the report downloading
            'SetCursorPos 1003, 62 'X New Serial Number Aging Pop Up
            'Application.Wait (Now + TimeValue("00:00:02"))
            'mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            'mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            'Application.Wait (Now + TimeValue("00:00:05"))
            
            SetCursorPos 503, 112 'Site
            Application.Wait (Now + TimeValue("00:00:02"))
            mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("{DOWN}{DOWN}{DOWN}{DOWN}") 'Select WS
            Application.Wait (Now + TimeValue("00:00:03"))
            SendKeys ("{ENTER}") 'Select Seaside
            Application.Wait (Now + TimeValue("00:00:03"))
            
            SetCursorPos 966, 110 'Focused Factory
            Application.Wait (Now + TimeValue("00:00:02"))
            mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("{DOWN}") 'Select WS
            Application.Wait (Now + TimeValue("00:00:03"))
            SendKeys (" ") 'Select Seaside
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("{DOWN}") 'Select WS
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys (" ") 'Select Seaside
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("{DOWN}") 'Select WS
            Application.Wait (Now + TimeValue("00:00:03"))
            SendKeys (" ") 'Select Seaside
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("{DOWN}") 'Select WS
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys (" ") 'Select Seaside
            Application.Wait (Now + TimeValue("00:00:03"))
        Else
            'Bangkok
            SetCursorPos 503, 112 'Site
            Application.Wait (Now + TimeValue("00:00:02"))
            mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("B") 'Select WS
            Application.Wait (Now + TimeValue("00:00:03"))
            SendKeys ("{ENTER}") 'Select Seaside
            Application.Wait (Now + TimeValue("00:00:03"))
            
            SetCursorPos 966, 110 'Focused Factory
            Application.Wait (Now + TimeValue("00:00:02"))
            mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
            mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("{DOWN}") 'Select 9301
            Application.Wait (Now + TimeValue("00:00:03"))
            SendKeys (" ") 'Enter
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys ("{DOWN}") 'Select 9302
            Application.Wait (Now + TimeValue("00:00:02"))
            SendKeys (" ") 'Enter
        End If
        
        Application.Wait (Now + TimeValue("00:00:02"))
        SendKeys ("{ENTER}")
        Application.Wait (Now + TimeValue("00:00:05"))
        
        SetForegroundWindow hwndParent
        Application.Wait (Now + TimeValue("00:00:01"))
        SendKeys ("{ENTER}")
        Application.Wait (Now + TimeValue("00:00:30"))
        For myCounter = 1 To 100
            Application.Wait (Now + TimeValue("00:00:20"))
            hwndParent = FindWindow(vbNullString, "Global Shop Floor - PROD")
            'Ver2.5:
            'TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.MDICLIENT.app.0.30495d1_r9_ad1", vbNullString)
            'TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", "Serial Number Aging")
            'TextBoxHandle2 = FindWindowEx(TextBoxHandle, TextBoxHandle1, "WindowsForms10.Window.8.app.0.30495d1_r9_ad1", "Serial Number Aging")
            TextBoxHandle = FindWindowEx(hwndParent, 0&, "WindowsForms10.MDICLIENT.app.0.30495d1_r" & myWnd & "_ad1", vbNullString)
            TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", "Serial Number Aging")
            TextBoxHandle2 = FindWindowEx(TextBoxHandle, TextBoxHandle1, "WindowsForms10.Window.8.app.0.30495d1_r" & myWnd & "_ad1", "Serial Number Aging")
            If TextBoxHandle2 <> 0 Then
                Exit For
            End If
        Next myCounter
        If TextBoxHandle2 = "" Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Output screen.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Output screen</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
        Application.Wait (Now + TimeValue("00:00:30"))
        
        'Do Until Application.Cursor = xlDefault ---> To export the report
        SetForegroundWindow hwndParent
        Application.Wait (Now + TimeValue("00:00:01"))
        SetCursorPos 460, 357 'Inventory
        handleWaitCursor = LoadCursor(ByVal 0&, IDC_WAIT)
        pci.cbSize = Len(pci)
        ret = GetCursorInfo(pci)
        ' Returns true when current cursor equals to wait cursor
        Application.Wait (Now + TimeValue("00:00:03"))
        IsWaitCursor = (pci.hCursor = handleWaitCursor)
        
        For myCounter = 1 To 100
            If Application.Cursor = xlDefault Then
                Exit For
            Else
                DoEvents
                Application.Wait (Now + TimeValue("00:00:30"))
                handleWaitCursor = LoadCursor(ByVal 0&, IDC_WAIT)
                pci.cbSize = Len(pci)
                ret = GetCursorInfo(pci)
                ' Returns true when current cursor equals to wait cursor
                Application.Wait (Now + TimeValue("00:00:03"))
                IsWaitCursor = (pci.hCursor = handleWaitCursor)
            End If
        Next myCounter
        If myCounter > 100 Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Waiting too long to export the report.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Waiting too long to export the report</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
        
        Application.Wait (Now + TimeValue("00:00:02"))
        mouse_event MOUSEEVENTF_RIGHTDOWN, 0, 0, 0, 0
        mouse_event MOUSEEVENTF_RIGHTUP, 0, 0, 0, 0
        Application.Wait (Now + TimeValue("00:00:03"))
        SendKeys ("E")
        Application.Wait (Now + TimeValue("00:00:03"))
        SendKeys ("E")
        Application.Wait (Now + TimeValue("00:00:02"))
        
        hwndExporting = FindWindow(vbNullString, "Exporting")
        For myCounter = 1 To 100
            Application.Wait (Now + TimeValue("00:00:10"))
            hwndExporting = FindWindow(vbNullString, "Exporting")
            If hwndExporting <> 0 Then
                Exit For
            End If
        Next myCounter
        If myCounter > 100 Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Exporting windows.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Exporting windows.</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
        
        hwndParentSaveAs = FindWindow(vbNullString, "Save As")
        For myCounter = 1 To 100
            Application.Wait (Now + TimeValue("00:00:10"))
            hwndParentSaveAs = FindWindow(vbNullString, "Save As")
            If hwndParentSaveAs <> 0 Then
                Exit For
            End If
        Next myCounter
        If myCounter > 100 Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Save As windows.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Save As windows.</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
        Application.Wait (Now + TimeValue("00:00:05"))
        'Get Address Bar Button
        TextBoxHandle = FindWindowEx(hwndParentSaveAs, 0&, "WorkerW", vbNullString)
        TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "ReBarWindow32", vbNullString)
        TextBoxHandle2 = FindWindowEx(TextBoxHandle1, 0&, "Address Band Root", vbNullString)
        TextBoxHandle3 = FindWindowEx(TextBoxHandle2, 0&, "msctls_progress32", vbNullString)
        TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "Breadcrumb Parent", vbNullString)
        TextBoxHandle5 = FindWindowEx(TextBoxHandle4, 0&, "ToolbarWindow32", vbNullString)
        'SendMessageByString TextBoxHandle5, WM_SETTEXT, 0, myMacroPath & "\"
        PostMessage TextBoxHandle5, &H201, 0&, 0& 'WM_LBUTTONDOWN = &H201
        Application.Wait (Now + TimeValue("00:00:01"))
        PostMessage TextBoxHandle5, &H202, 0&, 0& 'WM_LBUTTONUP = &H202
        Application.Wait (Now + TimeValue("00:00:01"))
        
        'Send save location
        hwndParentSaveAs = FindWindow(vbNullString, "Save As")
        TextBoxHandle = FindWindowEx(hwndParentSaveAs, 0&, "WorkerW", vbNullString)
        TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "ReBarWindow32", vbNullString)
        TextBoxHandle2 = FindWindowEx(TextBoxHandle1, 0&, "Address Band Root", vbNullString)
        TextBoxHandle3 = FindWindowEx(TextBoxHandle2, 0&, "msctls_progress32", vbNullString)
        TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "ComboBoxEx32", vbNullString)
        TextBoxHandle5 = FindWindowEx(TextBoxHandle4, 0&, "ComboBox", vbNullString)
        TextBoxHandle6 = FindWindowEx(TextBoxHandle5, 0&, "Edit", vbNullString)
        If TextBoxHandle6 = "" Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Save As windows.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Save As windows</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
        SendMessageByString TextBoxHandle6, WM_SETTEXT, 0, myMacroPath & "\"
        Application.Wait (Now + TimeValue("00:00:05"))
        'PostMessage TextBoxHandle6, &H201, 0&, 0& 'WM_LBUTTONDOWN = &H201
        'PostMessage TextBoxHandle6, &H202, 0&, 0& 'WM_LBUTTONUP = &H202
        
        'Find goto button and Click
        hwndParentSaveAs = FindWindow(vbNullString, "Save As")
        TextBoxHandle = FindWindowEx(hwndParentSaveAs, 0&, "WorkerW", vbNullString)
        TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "ReBarWindow32", vbNullString)
        TextBoxHandle2 = FindWindowEx(TextBoxHandle1, 0&, "Address Band Root", vbNullString)
        TextBoxHandle3 = FindWindowEx(TextBoxHandle2, 0&, "msctls_progress32", vbNullString)
        TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "ToolbarWindow32", vbNullString)
        'TextBoxHandle5 = FindWindowEx(TextBoxHandle4, 0&, "Address band toolbar", vbNullString)
    
        If TextBoxHandle4 = "" Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Save As windows.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Save As windows.</html>", _
                myAttachement(), _
                0, 0)
                
            GoTo myEnd
        End If
        'SendMessageByString TextBoxHandle5, WM_SETTEXT, 0, myMacroPath & "\"
        PostMessage TextBoxHandle4, &H201, 0&, 0& 'WM_LBUTTONDOWN = &H201
        Application.Wait (Now + TimeValue("00:00:01"))
        PostMessage TextBoxHandle4, &H202, 0&, 0& 'WM_LBUTTONUP = &H202
        Application.Wait (Now + TimeValue("00:00:01"))
        
        Application.Wait (Now + TimeValue("00:00:04"))
        'Find Filename Texbox
        hwndParentSaveAs = FindWindow(vbNullString, "Save As")
        TextBoxHandle = FindWindowEx(hwndParentSaveAs, 0&, "DUIViewWndClassName", vbNullString)
        TextBoxHandle1 = FindWindowEx(TextBoxHandle, 0&, "DirectUIHWND", vbNullString)
        TextBoxHandle2 = FindWindowEx(TextBoxHandle1, 0&, "FloatNotifySink", vbNullString)
    '        TextBoxHandle21 = FindWindowEx(TextBoxHandle1, TextBoxHandle2, "FloatNotifySink", vbNullString)
    '        TextBoxHandle22 = FindWindowEx(TextBoxHandle1, TextBoxHandle21, "FloatNotifySink", vbNullString)
    '
        TextBoxHandle3 = FindWindowEx(TextBoxHandle2, 0&, "ComboBox", vbNullString)
        TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "Edit", vbNullString)
            'Ver2.1:
            If TextBoxHandle4 = 0 Then
                TextBoxHandle21 = FindWindowEx(TextBoxHandle1, TextBoxHandle2, "FloatNotifySink", vbNullString)
                TextBoxHandle3 = FindWindowEx(TextBoxHandle21, 0&, "ComboBox", vbNullString)
                TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "Edit", vbNullString)
            End If
            If TextBoxHandle4 = 0 Then
                TextBoxHandle21 = FindWindowEx(TextBoxHandle1, TextBoxHandle2, "FloatNotifySink", vbNullString)
                TextBoxHandle22 = FindWindowEx(TextBoxHandle1, TextBoxHandle21, "FloatNotifySink", vbNullString)
                TextBoxHandle3 = FindWindowEx(TextBoxHandle22, 0&, "ComboBox", vbNullString)
                TextBoxHandle4 = FindWindowEx(TextBoxHandle3, 0&, "Edit", vbNullString)
            End If
        'If TextBoxHandle4 = "" Then
        If TextBoxHandle4 = 0 Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Save As Filename textbox.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Save As Filename textbox</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
        If myX = 1 Then
            SendMessageByString TextBoxHandle4, WM_SETTEXT, 0, "Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx"
        ElseIf myX = 2 Then
            SendMessageByString TextBoxHandle4, WM_SETTEXT, 0, "Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx"
        Else
            SendMessageByString TextBoxHandle4, WM_SETTEXT, 0, "Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx"
        End If
        Application.Wait (Now + TimeValue("00:00:01"))
        
        'Find Save Button
        hwndParentSaveAs = FindWindow(vbNullString, "Save As")
        TextBoxHandle = FindWindowEx(hwndParentSaveAs, 0&, "Button", "&Save")
        If TextBoxHandle = "" Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "Unable to find Save button.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Unable to find Save button.</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
    '    PostMessage TextBoxHandle, &H201, 0&, 0& 'WM_LBUTTONDOWN = &H201
    '    Application.Wait (Now + TimeValue("00:00:01"))
    '    PostMessage TextBoxHandle, &H202, 0&, 0& 'WM_LBUTTONUP = &H202
    '    Application.Wait (Now + TimeValue("00:00:01"))
        PostMessage TextBoxHandle, BM_CLICK, 0, 0
        Application.Wait (Now + TimeValue("00:00:03"))
        
        'Ver1.2: Unable to download file
        Application.Wait (Now + TimeValue("00:00:05"))
        hwndParentSaveAs = FindWindow(vbNullString, "Save As")
        If hwndParentSaveAs = FindWindow(vbNullString, "Save As") > 0 Then
            PostMessage TextBoxHandle, &H201, 0&, 0& 'WM_LBUTTONDOWN = &H201
            Application.Wait (Now + TimeValue("00:00:01"))
            PostMessage TextBoxHandle, &H202, 0&, 0& 'WM_LBUTTONUP = &H202
            Application.Wait (Now + TimeValue("00:00:01"))
        End If
        
        'Check downloaded file
        'myMacroPath & "\"
        For myCounter = 1 To 100
            Application.Wait (Now + TimeValue("00:00:10"))
            'Ver2.4:
            If myX = 1 Then
                myFile = Dir(myMacroPath & "\Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx")
            ElseIf myX = 2 Then
                myFile = Dir(myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx")
            Else
                myFile = Dir(myMacroPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx")
            End If
            If myFile <> "" Then
                Exit For
            End If
        Next myCounter
        If myCounter > 100 Then
            'Call SendEmail("sk.loon@plexus.com", "GSF Report download error", "File download error.")
            Call SendSmtpEmail( _
                "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                "sk.loon@plexus.com", _
                "", _
                "", _
                ThisWorkbook.Name & " Error!", _
                "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>File download error</html>", _
                myAttachement(), _
                0, 0)
            
            GoTo myEnd
        End If
        
        'Ver3.0: execute at the end of the report downloading
        SetCursorPos 1003, 62 'X New Serial Number Aging Pop Up
        Application.Wait (Now + TimeValue("00:00:02"))
        mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
        mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
        Application.Wait (Now + TimeValue("00:00:05"))
        
            '\\pena-dsk-601\ISL_General\01.Magnum\MCC
            '\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC
            
        'Check Folder Availbility "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP"
        'Year
        '01.Magnum
        'myFolderCheck = Dir("\\pena-dsk-601\ISL_General\01.Magnum\", vbDirectory)
        myFolderCheck = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC", vbDirectory)
        If myFolderCheck = "" Then
            'MkDir "\\pena-dsk-601\ISL_General\01.Magnum\"
            MkDir "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC"
        End If
        'MCC
        'myFolderCheck = Dir("\\pena-dsk-601\ISL_General\01.Magnum\MCC\", vbDirectory)
        myFolderCheck = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\", vbDirectory)
        If myFolderCheck = "" Then
            'MkDir "\\pena-dsk-601\ISL_General\01.Magnum\MCC\"
            MkDir "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\"
        End If
        'Macro WIP
        'myFolderCheck = Dir("\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\", vbDirectory)
        myFolderCheck = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\", vbDirectory)
        If myFolderCheck = "" Then
            'MkDir "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\"
            MkDir "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\"
        End If
        'Year
        myYear = Format(Date, "Yyyy")
        'myFolderCheck = Dir("\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\" & myYear, vbDirectory)
        myFolderCheck = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\" & myYear, vbDirectory)
        If myFolderCheck = "" Then
            'MkDir "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\" & myYear
            MkDir "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\" & myYear
        End If
        'Month
        myMonth = Format(Date, "Mmm")
        'myFolderCheck = Dir("\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\" & myYear & "\" & myMonth, vbDirectory)
        myFolderCheck = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\" & myYear & "\" & myMonth, vbDirectory)
        If myFolderCheck = "" Then
            'MkDir "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\" & myYear & "\" & myMonth
            MkDir "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\" & myYear & "\" & myMonth
        End If
        'mySavePath = "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\" & myYear & "\" & myMonth
        mySavePath = "\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_TeradyneMCC\MCC\Macro WIP\" & myYear & "\" & myMonth
        
        'Local Path
        myFolderCheck = Dir(myMacroPath & "\" & myYear, vbDirectory)
        If myFolderCheck = "" Then
            MkDir myMacroPath & "\" & myYear
        End If
        myFolderCheck = Dir(myMacroPath & "\" & myYear & "\" & myMonth, vbDirectory)
        If myFolderCheck = "" Then
            MkDir myMacroPath & "\" & myYear & "\" & myMonth
        End If
        myLocalPath = myMacroPath & "\" & myYear & "\" & myMonth
        
        'Seaside Path
        'Macro WIP
        myFolderCheck = Dir("\\ap\mfg\PenaData\Apps_Integration\ISL_SystemAnalyticalAutomation\Backup\Seaside\Macro WIP\" & myYear, vbDirectory)
        If myFolderCheck = "" Then
            MkDir "\\ap\mfg\PenaData\Apps_Integration\ISL_SystemAnalyticalAutomation\Backup\Seaside\Macro WIP\" & myYear
        End If
        'Year
        myFolderCheck = Dir("\\ap\mfg\PenaData\Apps_Integration\ISL_SystemAnalyticalAutomation\Backup\Seaside\Macro WIP\" & myYear, vbDirectory)
        If myFolderCheck = "" Then
            MkDir "\\ap\mfg\PenaData\Apps_Integration\ISL_SystemAnalyticalAutomation\Backup\Seaside\Macro WIP\" & myYear
        End If
        'Month
        myMonth = Format(Date, "Mmm")
        myFolderCheck = Dir("\\ap\mfg\PenaData\Apps_Integration\ISL_SystemAnalyticalAutomation\Backup\Seaside\Macro WIP\" & myYear & "\" & myMonth, vbDirectory)
        If myFolderCheck = "" Then
            MkDir "\\ap\mfg\PenaData\Apps_Integration\ISL_SystemAnalyticalAutomation\Backup\Seaside\Macro WIP\" & myYear & "\" & myMonth
        End If
        'Ver2.6: Change Shared path
        ''mySavePath = "\\pena-dsk-601\ISL_General\01.Magnum\MCC\Macro WIP\" & myYear & "\" & myMonth
        'mySeasidePath = "\\ap\mfg\PenaData\Apps_Integration\ISL_SystemAnalyticalAutomation\Backup\Seaside\Macro WIP\" & myYear & "\" & myMonth
        mySeasidePath = "\\ap\mfg\PenaData\Apps_Integration\SEA_SystemAnalyticalAutomation\WIP_Report\" & myYear & "\" & myMonth
        
        a = 0
        'Bangkok Path
        'myBgkFile = Dir("\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear & "\" & myMonth & "\Serial Number Aging 571-" & myDate & ".xlsx", vbNormal)
        'Macro WIP
        myFolderCheck = Dir("\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear, vbDirectory)
        If myFolderCheck = "" Then
            MkDir "\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear
        End If
        'Year
        myFolderCheck = Dir("\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear, vbDirectory)
        If myFolderCheck = "" Then
            MkDir "\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear
        End If
        'Month
        myMonth = Format(Date, "Mmm")
        myFolderCheck = Dir("\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear & "\" & myMonth, vbDirectory)
        If myFolderCheck = "" Then
            MkDir "\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear & "\" & myMonth
        End If
        myBangkokPath = "\\ap\mfg\BgkData\Apps_Integration\SystemAnalyticalAutomation\Operation\WIP_Report\" & myYear & "\" & myMonth
        
            'Workbooks.Open myMacroPath & "\Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx", ReadOnly:=True
        'Ver2.2:
        If myX = 1 Then
            Workbooks.Open myMacroPath & "\Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx", ReadOnly:=True
            myMasterFile = "Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx"
            'Ver3.0: Check for correct site
            If Left(Range("E10").Value, 3) <> "830" Then
                Workbooks(myMasterFile).Close False
                Call SendSmtpEmail( _
                    "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                    "sk.loon@plexus.com", _
                    "", _
                    "", _
                    ThisWorkbook.Name & " Error!", _
                    "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Islandview GSF Report: Wrong site downloaded.</html>", _
                    myAttachement(), _
                    0, 0)
                GoTo myEnd
            End If
        ElseIf myX = 2 Then
            Workbooks.Open myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx", ReadOnly:=True
            myMasterFile = "Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx"
            'Ver3.0: Check for correct site
            If Left(Range("E10").Value, 3) <> "370" Then
                Workbooks(myMasterFile).Close False
                Call SendSmtpEmail( _
                    "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                    "sk.loon@plexus.com", _
                    "", _
                    "", _
                    ThisWorkbook.Name & " Error!", _
                    "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Seaside GSF Report: Wrong site downloaded.</html>", _
                    myAttachement(), _
                    0, 0)
                GoTo myEnd
            End If
            
        Else
            Workbooks.Open myMacroPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx", ReadOnly:=True
            myMasterFile = "Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx"
            'Ver3.0: Check for correct site
            If Left(Range("E10").Value, 3) <> "930" Then
                Workbooks(myMasterFile).Close False
                Call SendSmtpEmail( _
                    "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                    "sk.loon@plexus.com", _
                    "", _
                    "", _
                    ThisWorkbook.Name & " Error!", _
                    "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Bangkok GSF Report: Wrong site downloaded.</html>", _
                    myAttachement(), _
                    0, 0)
                GoTo myEnd
            End If
        End If
        'Ver1.5: Make Sure  WS is selected
        myWsCheck = Application.WorksheetFunction.CountIf(Columns("I:I"), "WS")
        If myWsCheck > 0 Then
            'Ver2.2:
            'myMasterFile = "Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx"
            'myTotalTemp = Range("A" & Rows.Count).End(xlUp).Row
            myTotalTemp = Range("F" & Rows.Count).End(xlUp).Row
            Range("A9:AA" & myTotalTemp).Copy
            Workbooks.Add
            Range("A1").PasteSpecial xlPasteValues
            Columns("B:B").Delete
            Columns("C:C").Delete
            Columns("N:N").Delete
            Columns("T:U").Delete
            
            Selection.Font.Name = "Arial"
            Selection.Font.Size = 8
            Range("A1:V1").Font.Bold = True
            Range("A1:V1").Interior.Color = 11829830 'Blue
            Range("A1:V1").WrapText = True
            myTotalTemp = Range("A" & Rows.Count).End(xlUp).Row
            Range("A1:V" & myTotalTemp).Borders(xlEdgeLeft).LineStyle = xlContinuous
            Range("A1:V" & myTotalTemp).Borders(xlEdgeTop).LineStyle = xlContinuous
            Range("A1:V" & myTotalTemp).Borders(xlEdgeBottom).LineStyle = xlContinuous
            Range("A1:V" & myTotalTemp).Borders(xlEdgeRight).LineStyle = xlContinuous
            Range("A1:V" & myTotalTemp).Borders(xlInsideVertical).LineStyle = xlContinuous
            Range("A1:V" & myTotalTemp).Borders(xlInsideHorizontal).LineStyle = xlContinuous
            myMasterFile = ActiveWorkbook.Name
            ActiveSheet.Name = "SerialNumberAgingReport"
            'myMasterTemp = myTotalTemp
            myTotalTemp = Range("A" & Rows.Count).End(xlUp).Row
            'Ver2.2: add in MPF
            Sheets.Add
            ActiveSheet.Name = "Mpf"
            Range("A1:A" & myTotalTemp).Value = Sheets("SerialNumberAgingReport").Range("D1:D" & myTotalTemp).Value
            Range("A1:A" & myTotalTemp).RemoveDuplicates Columns:=1, Header:=xlNo
            myTotalMpf = Range("A" & Rows.Count).End(xlUp).Row
            Sheets("SerialNumberAgingReport").Select
            
            If myX = 1 Then
                '****Serial Number Aging 198*******************************************************************************************************************************************
                ActiveSheet.Copy
                Range("W1:W" & myTotalTemp).Value = "=IF(D1=""198-Teradyne - Nextest Division"",Row(D1),""Delete"")"
                Range("W1:W" & myTotalTemp).Value = Range("W1:W" & myTotalTemp).Value
                Range("A1:W" & myTotalTemp + 1).RemoveDuplicates Columns:=23, Header:=xlNo
                Columns("W:W").ClearContents
                Columns("A:W").AutoFit
                myClearRow = Range("A" & Rows.Count).End(xlUp).Row
                Rows(myClearRow + 1 & ":" & myTotalTemp).Delete
                ActiveWorkbook.SaveAs Filename:=mySavePath & "\Serial Number Aging 198-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                ActiveWorkbook.SaveAs Filename:=myLocalPath & "\Serial Number Aging 198-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                Workbooks("Serial Number Aging 198-" & Format(Date, "MMDDYYYY") & ".xlsx").Close False
                '****Serial Number Aging 260*******************************************************************************************************************************************
                Workbooks(myMasterFile).Sheets("SerialNumberAgingReport").Copy
                Range("W1:W" & myTotalTemp).Value = "=IF(D1=""260-Teradyne Corporation HDD"",Row(D1),""Delete"")"
                Range("W1:W" & myTotalTemp).Value = Range("W1:W" & myTotalTemp).Value
                Range("A1:W" & myTotalTemp + 1).RemoveDuplicates Columns:=23, Header:=xlNo
                Columns("W:W").ClearContents
                Columns("A:W").AutoFit
                myClearRow = Range("A" & Rows.Count).End(xlUp).Row
                Rows(myClearRow + 1 & ":" & myTotalTemp).Delete
                ActiveWorkbook.SaveAs Filename:=mySavePath & "\Serial Number Aging 260-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                ActiveWorkbook.SaveAs Filename:=myLocalPath & "\Serial Number Aging 260-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                Workbooks("Serial Number Aging 260-" & Format(Date, "MMDDYYYY") & ".xlsx").Close False
                '****Serial Number Aging 318*******************************************************************************************************************************************
                Workbooks(myMasterFile).Sheets("SerialNumberAgingReport").Copy
                'Range("W1:W" & myTotalTemp).Value = "=IF(D1=""318-Teradyne Eagle"",Row(D1),""Delete"")"
                Range("W1:W" & myTotalTemp).Value = "=IF(D1=""318-Teradyne Eagle"",IF(G1=""WS"",""Delete"",Row(D1)),""Delete"")"
                Range("W1:W" & myTotalTemp).Value = Range("W1:W" & myTotalTemp).Value
                Range("A1:W" & myTotalTemp + 1).RemoveDuplicates Columns:=23, Header:=xlNo
                Columns("W:W").ClearContents
                Columns("A:W").AutoFit
                myClearRow = Range("A" & Rows.Count).End(xlUp).Row
                Rows(myClearRow + 1 & ":" & myTotalTemp).Delete
                Application.DisplayAlerts = False
                ActiveWorkbook.SaveAs Filename:=mySavePath & "\Serial Number Aging 318-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                    'Ver2.8: Remove Weng Lim Share drive saving
                    ''Ver2.7: Save to Weng Lim Share drive
                    'myFolderCheck = Dir("\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_ETS_Opr\02 Users Folder\Jack\9. Kaizen\Raw Files", vbDirectory)
                    'If myFolderCheck <> "" Then
                    '    ActiveWorkbook.SaveAs Filename:=myLocalPath & "\Serial Number Aging 318-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                    'End If
                    'ActiveWorkbook.SaveAs Filename:="\\ap\mfg\PenaData\ISL\ISL_Operations\MFG_ETS_Opr\02 Users Folder\Jack\9. Kaizen\Raw Files\Serial Number Aging 318-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                    ActiveWorkbook.SaveAs Filename:=myLocalPath & "\Serial Number Aging 318-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                Application.DisplayAlerts = True
                Workbooks("Serial Number Aging 318-" & Format(Date, "MMDDYYYY") & ".xlsx").Close False
                Workbooks(myMasterFile).Close False
                Workbooks("Serial Number Aging " & Format(Date, "MmDdYyyy") & ".xlsx").Close False
                '
                Application.EnableEvents = True
                'Call SendEmail("sk.loon@plexus.com", "GSF Report (Islandview) has been save in share drive", "Successful...")
                Call SendSmtpEmail( _
                    "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                    "sk.loon@plexus.com", _
                    "", _
                    "", _
                    "GSF Serial Number Aging Report (Islandview) has been save in share drive", _
                    "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Successful...</html>", _
                    myAttachement(), _
                    0, 0)
                
            ElseIf myX = 2 Then
                For myY = 2 To myTotalMpf
                    Workbooks(myMasterFile).Sheets("SerialNumberAgingReport").Copy
                    Range("W1:W" & myTotalTemp).Value = "=IF(D1=""" & Workbooks(myMasterFile).Sheets("Mpf").Range("A" & myY).Value & """,Row(D1),""Delete"")"
                    Range("W1:W" & myTotalTemp).Value = Range("W1:W" & myTotalTemp).Value
                    Range("A1:W" & myTotalTemp + 1).RemoveDuplicates Columns:=23, Header:=xlNo
                    Columns("W:W").ClearContents
                    Columns("A:W").AutoFit
                    myClearRow = Range("A" & Rows.Count).End(xlUp).Row
                    Rows(myClearRow + 1 & ":" & myTotalTemp).Delete
                    myMpfName = Left(Workbooks(myMasterFile).Sheets("Mpf").Range("A" & myY).Value, 3)
                    Application.DisplayAlerts = False
                    ActiveWorkbook.SaveAs Filename:=mySeasidePath & "\Serial Number Aging " & myMpfName & "-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                    ActiveWorkbook.SaveAs Filename:=myLocalPath & "\Serial Number Aging " & myMpfName & "-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                    Application.DisplayAlerts = True
                    Workbooks("Serial Number Aging " & myMpfName & "-" & Format(Date, "MMDDYYYY") & ".xlsx").Close False
                Next myY
                'Ver2.2:
                Workbooks(myMasterFile).Close False
                'Call SendEmail("sk.loon@plexus.com", "GSF Report (Seaside) has been save in share drive", "Successful...")
                Call SendSmtpEmail( _
                    "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                    "sk.loon@plexus.com", _
                    "", _
                    "", _
                    "GSF Serial Number Aging Report (Seaside) has been save in share drive", _
                    "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Successful...</html>", _
                    myAttachement(), _
                    0, 0)
                'Ver3.2:
                fso.CopyFile myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx", mySeasidePath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx", True
                
            Else
                For myY = 2 To myTotalMpf
                    Workbooks(myMasterFile).Sheets("SerialNumberAgingReport").Copy
                    Range("W1:W" & myTotalTemp).Value = "=IF(D1=""" & Workbooks(myMasterFile).Sheets("Mpf").Range("A" & myY).Value & """,Row(D1),""Delete"")"
                    Range("W1:W" & myTotalTemp).Value = Range("W1:W" & myTotalTemp).Value
                    Range("A1:W" & myTotalTemp + 1).RemoveDuplicates Columns:=23, Header:=xlNo
                    Columns("W:W").ClearContents
                    Columns("A:W").AutoFit
                    myClearRow = Range("A" & Rows.Count).End(xlUp).Row
                    Rows(myClearRow + 1 & ":" & myTotalTemp).Delete
                    myMpfName = Left(Workbooks(myMasterFile).Sheets("Mpf").Range("A" & myY).Value, 3)
                    Application.DisplayAlerts = False
                    ActiveWorkbook.SaveAs Filename:=myBangkokPath & "\Serial Number Aging " & myMpfName & "-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                    ActiveWorkbook.SaveAs Filename:=myLocalPath & "\Serial Number Aging " & myMpfName & " (BGK)-" & Format(Date, "MMDDYYYY") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
                    Application.DisplayAlerts = True
                    Workbooks("Serial Number Aging " & myMpfName & " (BGK)-" & Format(Date, "MMDDYYYY") & ".xlsx").Close False
                Next myY
                Workbooks(myMasterFile).Close False
                'Send email
                Call SendSmtpEmail( _
                    "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                    "sk.loon@plexus.com", _
                    "", _
                    "", _
                    "GSF Serial Number Aging Report (Bangkok) has been save in share drive", _
                    "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>Successful...</html>", _
                    myAttachement(), _
                    0, 0)
                'Ver3.3:
                ''Ver3.1:
                'fso.CopyFile myMacroPath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx", mySeasidePath & "\Serial Number Aging Seaside " & Format(Date, "MmDdYyyy") & ".xlsx", True
                fso.CopyFile myMacroPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx", myBangkokPath & "\Serial Number Aging Bangkok " & Format(Date, "MmDdYyyy") & ".xlsx", True
                
            End If
        Else
            ActiveWorkbook.Close False
            myRetryAgain = myRetryAgain + 1
            If myRetryAgain > 3 Then
                'Call SendEmail("sk.loon@plexus.com", "GSF Report doen't have WS work order type.", "Error...")
                Call SendSmtpEmail( _
                        "PLXS-MFG Islandview SystemAnalyticalAutomation <PLXS-MFG.Islandview.SystemAnalyticalAutomation@plexus.com>", _
                        "sk.loon@plexus.com", _
                        "", _
                        "", _
                        ThisWorkbook.Name & " Error!", _
                        "<html><BODY style=font-size:11pt;font-family:Calibri><p>******** Automated Reporting *******<br>GSF Report doen't have WS work order type.</html>", _
                        myAttachement(), _
                        0, 0)
            Else
                SendMessage hwndParent, WM_CLOSE, 0, 0 'Close WMS
                GoTo myRetry
            End If
        End If
myNext:
    Next myX
    SendMessage hwndParent, WM_CLOSE, 0, 0 'Close WMS
    
    ActiveWorkbook.Save
    Application.DisplayAlerts = False
    Application.Quit
    End
myEnd:
    SendMessage hwndParent, WM_CLOSE, 0, 0 'Close WMS
'    Call SendEmail("sk.loon@plexus.com", "GSF Report error!", "Unknown error...")
'    Application.EnableEvents = False
'    ActiveWorkbook.Close False
'    ActiveWorkbook.Close False
'    Application.EnableEvents = True
    Application.DisplayAlerts = False
    ActiveWorkbook.Close False
    Application.Quit
    
End Sub
Sub PasteAll()
    On Error Resume Next
    Range("A1").PasteSpecial xlPasteAll
End Sub
Sub ReadAllData()
    mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
    mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
    mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
    mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
    Application.Wait (Now + TimeValue("00:00:01"))
    'Application.SendKeys ("^a")
    'Application.Wait (Now + TimeValue("00:00:01"))
    SendKeys "^{C}"
    Application.Wait (Now + TimeValue("00:00:01"))
End Sub
Private Sub MoveSingle(myX, myY)
    SetCursorPos myX, myY 'x and y position
    Application.Wait (Now + TimeValue("00:00:01"))
    mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
    mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
End Sub
Private Sub MoveSingleClick(myX, myY)
  SetCursorPos myX, myY 'x and y position
  Application.Wait (Now + TimeValue("00:00:01"))
  mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
  mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
End Sub
Private Sub SingleClick()
  SetCursorPos 100, 100 'x and y position
  mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
  mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
End Sub

Private Sub DoubleClick()
  'Double click as a quick series of two clicks
  SetCursorPos 100, 100 'x and y position
  mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
  mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
  mouse_event MOUSEEVENTF_LEFTDOWN, 0, 0, 0, 0
  mouse_event MOUSEEVENTF_LEFTUP, 0, 0, 0, 0
End Sub

Private Sub RightClick()
  'Right click
  SetCursorPos 200, 200 'x and y position
  mouse_event MOUSEEVENTF_RIGHTDOWN, 0, 0, 0, 0
  mouse_event MOUSEEVENTF_RIGHTUP, 0, 0, 0, 0
End Sub
Sub TypeInCurrentWindow()
DoEvents
Application.EnableEvents = False
Sleep 5000

SendKeys "a"
SendKeys "^a", True 'Select All
Sleep 400 'Wait 0.4 seconds (400 milliseconds)
SendKeys "^c", True 'Copy
Sleep 400 'Wait 0.4 seconds
'SendKeys "abcd", True 'Type abcd
'Sleep 400 'Wait 0.4 seconds
Application.EnableEvents = True
End Sub
Sub GetCursorPosDemo()
Dim llCoord As POINTAPI
' Get the cursor positions
GetCursorPos llCoord
' Display the cursor position coordinates
MsgBox "X Position: " & llCoord.Xcoord & vbNewLine & "Y Position: " & llCoord.Ycoord
End Sub
Sub SendSmtpEmail(myFrom As String, myTo As String, myCc As String, myBcc As String, mySubject As String, myBody As String, myAttachment() As String, myTotalAtt As Integer, myTotalEmb As Integer)
    Dim iMsg As Object
    Dim iConf As Object
    Dim Flds As Variant
    Dim CDOMessage As Object
    Dim Configuration As Object

    
    Set iMsg = CreateObject("CDO.Message")
    Set iConf = CreateObject("CDO.Configuration")
    'i = 100
    iConf.Load -1 ' CDO Source Defaults
    Set Flds = iConf.Fields
    With Flds
        .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
        .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = "internet-smtp.plexus.com"
        .Item("http://schemas.microsoft.com/cdo/configuration/smtpserverport") = 25
        .Update
    End With
    
    With iMsg
        Set .Configuration = iConf
        .From = myFrom '"PLXS-MFG Bangkok SystemAnalyticalAutomation <PLXS-MFG.Bangkok.SystemAnalyticalAutomation@plexus.com>"
        .To = myTo '"sk.loon@plexus.com"
        .Cc = myCc
        .Bcc = myBcc
        For myA = 1 To myTotalAtt
            .AddAttachment myAttachment(myA - 1)
        Next myA
        For myB = 1 To myTotalEmb
            Set iBp = .Attachments.Item(myB)
            iBp.Fields.Item("urn:schemas:mailheader:content-id") = "Image" & myB
            iBp.Fields.Update
        Next myB
        .Subject = mySubject
        .HTMLBody = myBody
        .Send
    End With
    
    Set iMsg = Nothing
    Set iConf = Nothing
    Set Flds = Nothing
End Sub
Function RangetoHTML(rng As Range)
    
    Dim fso As Object
    Dim ts As Object
    Dim TempFile As String
    Dim TempWB As Workbook
    
    On Error GoTo myQuit
    TempFile = Environ$("temp") & "\" & Format(Now, "dd-mm-yy h-mm-ss") & ".htm"

    'Copy the range and create a new workbook to past the data in
    rng.Copy
    Set TempWB = Workbooks.Add(1)
    With TempWB.Sheets(1)
        Application.Wait (Now + TimeValue("00:00:01"))
        .Cells(1).PasteSpecial Paste:=8
        Application.Wait (Now + TimeValue("00:00:01"))
        .Cells(1).PasteSpecial xlPasteValues, , False, False
        Application.Wait (Now + TimeValue("00:00:01"))
        .Cells(1).PasteSpecial xlPasteFormats, , False, False
        Application.Wait (Now + TimeValue("00:00:01"))
        .Cells(1).Select
        Application.Wait (Now + TimeValue("00:00:01"))
        Application.CutCopyMode = False
        On Error Resume Next
        Application.Wait (Now + TimeValue("00:00:01"))
        .DrawingObjects.Visible = True
        Application.Wait (Now + TimeValue("00:00:01"))
        .DrawingObjects.Delete
        Application.Wait (Now + TimeValue("00:00:01"))
        On Error GoTo 0
    End With
    Application.Wait (Now + TimeValue("00:00:01"))
        
    'Publish the sheet to a htm file
    With TempWB.PublishObjects.Add( _
         SourceType:=xlSourceRange, _
         Filename:=TempFile, _
         Sheet:=TempWB.Sheets(1).Name, _
         Source:=TempWB.Sheets(1).UsedRange.Address, _
         HtmlType:=xlHtmlStatic)
        .Publish (True)
    End With

    'Read all data from the htm file into RangetoHTML
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set ts = fso.GetFile(TempFile).OpenAsTextStream(1, -2)
    Application.Wait (Now + TimeValue("00:00:01"))
    RangetoHTML = ts.ReadAll
    Application.Wait (Now + TimeValue("00:00:01"))
    ts.Close
    Application.Wait (Now + TimeValue("00:00:01"))
    RangetoHTML = Replace(RangetoHTML, "align=center x:publishsource=", "align=left x:publishsource=")
    Application.Wait (Now + TimeValue("00:00:01"))
        
    'Close TempWB
    TempWB.Close savechanges:=False
    Application.Wait (Now + TimeValue("00:00:01"))
        
    'Delete the htm file we used in this function
    Kill TempFile
    Application.Wait (Now + TimeValue("00:00:01"))
        
    Set ts = Nothing
    Set fso = Nothing
    Set TempWB = Nothing
myQuit:
End Function
